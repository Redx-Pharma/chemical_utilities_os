<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />


  <title>chemutil.classical_ml_model_build API documentation</title>
  <meta name="description" content="Module for sklearn model building" />


  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>

  <style type="text/css">
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}
</style>
  <style type="text/css">
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  }

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; }

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;

      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/
</style>
  <style type="text/css">
  pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #3D7B7B; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #F00 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666 } /* Operator */
.codehilite .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #9C6500 } /* Comment.Preproc */
.codehilite .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.codehilite .gr { color: #E40000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #008400 } /* Generic.Inserted */
.codehilite .go { color: #717171 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #04D } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #687822 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #00F; font-weight: bold } /* Name.Class */
.codehilite .no { color: #800 } /* Name.Constant */
.codehilite .nd { color: #A2F } /* Name.Decorator */
.codehilite .ni { color: #717171; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #00F } /* Name.Function */
.codehilite .nl { color: #767600 } /* Name.Label */
.codehilite .nn { color: #00F; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #A2F; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #BBB } /* Text.Whitespace */
.codehilite .mb { color: #666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666 } /* Literal.Number.Float */
.codehilite .mh { color: #666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #A45A77 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #00F } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666 } /* Literal.Number.Integer.Long */
  </style>
  <style type="text/css">
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}
</style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>
<div id="container">




















  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3>Super-module</h3>
      <ul>
        <li class="mono"><a href="index.html">chemutil</a></li>
      </ul>
    </li>
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>

  <ul>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.log">log</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>

  <ul>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.dc_sklearn_model_builder">dc_sklearn_model_builder</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.get_pearson_r">get_pearson_r</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></span>


  <ul>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_parameter_grid">build_parameter_grid</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_pipline_list">build_pipline_list</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_train_test_validate_splits">build_train_test_validate_splits</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.load_pipeline_into_class">load_pipeline_into_class</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.make_pipeline">make_pipeline</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.optimize_model">optimize_model</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.save_model">save_model</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.save_self">save_self</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor">RXKFoldGridSearchSklearnRegresssor</a></span>


  <ul>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.build_parameter_grid">build_parameter_grid</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.build_pipline_list">build_pipline_list</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.build_train_test_validate_splits">build_train_test_validate_splits</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.load_pipeline_into_class">load_pipeline_into_class</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.make_pipeline">make_pipeline</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.optimize_model">optimize_model</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.save_model">save_model</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.save_self">save_self</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor">RXTrainTestGridSearchSklearnRegresssor</a></span>


  <ul>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.build_parameter_grid">build_parameter_grid</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.build_pipline_list">build_pipline_list</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.build_train_test_validate_splits">build_train_test_validate_splits</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.load_pipeline_into_class">load_pipeline_into_class</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.make_pipeline">make_pipeline</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.optimize_model">optimize_model</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.save_model">save_model</a></li>
    <li class="mono"><a href="#chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.save_self">save_self</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

<article id="content">





  <header id="section-intro">
  <h1 class="title"><span class="name">chemutil.classical_ml_model_build</span> module</h1>
  <p>Module for sklearn model building</p>

  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build" class="source">
    <div class="codehilite"><pre><span></span><span class="ch">#!/usr/bin.env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for sklearn model building</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pkl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">deepchem</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">joblib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sklearn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">VotingRegressor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pearsonr</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">chemutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">classical_ml_models</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">helpers</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_pearson_r</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function which can be ysed to make a Pearson R scorer</span>

<span class="sd">    Args:</span>
<span class="sd">        x (numpy.ndarray): Data for the Pearson R correlation from one source</span>
<span class="sd">        y (numpy.ndarray): Data for the Pearson R correlation from another source</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Pearson R metric</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RXGridSearchSklearnRegresssor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to encapulate the model building process for scikit learn classical ML models using a train test and validate data splitting</span>

<span class="sd">    The idea of this class is to wrap up the sklearn pipeline model building and training in a single container which can be saved.</span>

<span class="sd">    For examples and information see the notebooks directory</span>

<span class="sd">    It is expected that this class is used in the following manner:</span>
<span class="sd">    1. Load you data and featurize from your moleucle representation:</span>
<span class="sd">    ```</span>
<span class="sd">    df = pd.read_csv(&quot;my_data.csv)</span>
<span class="sd">    feat_df = featurization.get_count_ecfp(data_df=df, smiles_column=&quot;smiles&quot;, return_df=True)</span>
<span class="sd">    ```</span>

<span class="sd">    2. Select your scikit learn model and parameter grid. You can use the default models provided in this libray which provides name, model and parameter grid to search as follows:</span>
<span class="sd">    ```</span>
<span class="sd">    my_model = classical_ml_models.linear_models(lasso=False, lars=False)[0]</span>
<span class="sd">    ```</span>

<span class="sd">    Alternatively wrap up your chosen model:</span>

<span class="sd">    ```</span>
<span class="sd">    from chemutil.classical_ml_models import skmodel</span>

<span class="sd">    my_model = skmodel(</span>
<span class="sd">        type(RandomForestRegressor()).__name__,</span>
<span class="sd">        RandomForestRegressor(random_state=helpers.random_seed, n_jobs=-1),</span>
<span class="sd">        {</span>
<span class="sd">            &quot;n_estimators&quot;: [50, 100, 200],</span>
<span class="sd">            &quot;min_samples_split&quot;: [2, 4],</span>
<span class="sd">            &quot;ccp_alpha&quot;: [0.0, 0.05],</span>
<span class="sd">            &quot;max_features&quot;: [&quot;sqrt&quot;, &quot;log2&quot;, 1.0],</span>
<span class="sd">        },</span>
<span class="sd">        {},</span>
<span class="sd">        True,</span>
<span class="sd">        &quot;https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html&quot;,</span>
<span class="sd">        sklearn.__version__,</span>
<span class="sd">        datetime.now(),</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>


<span class="sd">    3. Instantiate this class and load the model and data into the class</span>
<span class="sd">    ```</span>
<span class="sd">    cls = RXGridSearchSklearnRegresssor(</span>
<span class="sd">        feat_df,</span>
<span class="sd">        model=linear_regression_models.model,</span>
<span class="sd">        model_name=linear_regression_models.name</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>

<span class="sd">    4. Set your data splits this example is based on train test splits and uses tye molecular weight splitter from deepchem</span>
<span class="sd">    ```</span>
<span class="sd">    cls.build_trian_test_validate_splits(</span>
<span class="sd">        smiles_column=&quot;smiles&quot;,</span>
<span class="sd">        task_columns=[&quot;taskX&quot;],</span>
<span class="sd">        feature_column_regex=&quot;ecfp_count_bit_&quot;,</span>
<span class="sd">        splitter_type=&quot;mw&quot;,</span>
<span class="sd">        train=0.8,</span>
<span class="sd">        test=0.2,</span>
<span class="sd">        validation=None</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>

<span class="sd">    5. Define your sklearn pipeline to include, in addition to the model, any of the following elements feature_scaling, dimensionality_reduction or feature_selection. provide the word &quot;passthrough&quot; to activate this</span>
<span class="sd">    element or if you are fixing to just one method you can add that directly i.e. feature_scaling=MinMaxScaler(). Following this define the parameter grid to search. if you have activated any of the optional pipeline</span>
<span class="sd">    elements if you have activated an element with &quot;passthrough&quot; you must provide a key of the element mapping to the method eg {&quot;feature_scaling&quot;: MinMaxScaler()}. You can then extend the dictionary with</span>
<span class="sd">    hyper-parameters to try i.e. &quot;dimensionality_reduction&quot;: PCA(), &quot;n_components&quot;: [2, 3, 4], &quot;iterated_power&quot;: [2, 5, 7]}. For the model provide a dictionary of hyper parameters to grid search, not the dafualt models</span>
<span class="sd">    in this library have a grid which can be used by default.</span>

<span class="sd">    ```</span>
<span class="sd">    model.build_pipline_list(feature_scaling=&quot;passthrough&quot;)</span>
<span class="sd">    cls.build_parameter_grid(</span>
<span class="sd">        feature_scaling_param_grid={&quot;feature_scaling&quot;: [MinMaxScaler(), StandardScaler()]},</span>
<span class="sd">        model_param_grid=my_model.default_param_grid</span>
<span class="sd">    )</span>
<span class="sd">    cls.make_pipeline()</span>
<span class="sd">    ```</span>

<span class="sd">    6. You can now eun the grid search, defining scoring functions to use. Note the first one is used to identify the best model and refit</span>
<span class="sd">    ```</span>
<span class="sd">    gs = cls.optimize_model(scoring=(&quot;neg_root_mean_squared_error&quot;, &quot;r2&quot;))</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data_df</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">X_train</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">dc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">NumpyDataset</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y_train</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">dc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">NumpyDataset</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">X_test</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">dc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">NumpyDataset</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y_test</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">dc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">NumpyDataset</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">X_val</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">dc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">NumpyDataset</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y_val</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">dc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">NumpyDataset</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">kfolds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">dc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">NumpyDataset</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">classical_ml_models</span><span class="o">.</span><span class="n">skmodel</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pipeline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Pipeline</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">classical_ml_models</span><span class="o">.</span><span class="n">skmodel</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _summary_</span>

<span class="sd">        Args:</span>
<span class="sd">            data_df (Optional[pd.DataFrame], optional): _description_. Defaults to None.</span>
<span class="sd">            X_train (Optional[Union[np.ndarray, pd.DataFrame, dc.data.datasets.NumpyDataset]], optional): _description_. Defaults to None.</span>
<span class="sd">            y_train (Optional[Union[np.ndarray, pd.DataFrame, dc.data.datasets.NumpyDataset]], optional): _description_. Defaults to None.</span>
<span class="sd">            X_test (Optional[Union[np.ndarray, pd.DataFrame, dc.data.datasets.NumpyDataset]], optional): _description_. Defaults to None.</span>
<span class="sd">            y_test (Optional[Union[np.ndarray, pd.DataFrame, dc.data.datasets.NumpyDataset]], optional): _description_. Defaults to None.</span>
<span class="sd">            X_val (Optional[Union[np.ndarray, pd.DataFrame, dc.data.datasets.NumpyDataset]], optional): _description_. Defaults to None.</span>
<span class="sd">            y_val (Optional[Union[np.ndarray, pd.DataFrame, dc.data.datasets.NumpyDataset]], optional): _description_. Defaults to None.</span>
<span class="sd">            target_name (Optional[str], optional): _description_. Defaults to None.</span>
<span class="sd">            model_name (Optional[str], optional): _description_. Defaults to None.</span>
<span class="sd">            pipeline (Optional[Pipeline], optional): _description_. Defaults to None.</span>
<span class="sd">            param_grid (Optional[dict], optional): _description_. Defaults to None.</span>
<span class="sd">            _model: (Optional[str], optional): if you want to pass a trained and finalized model in at the start use this variable to set it. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># User arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span> <span class="o">=</span> <span class="n">data_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_validate</span> <span class="o">=</span> <span class="n">X_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_validate</span> <span class="o">=</span> <span class="n">y_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_name</span> <span class="o">=</span> <span class="n">target_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_name</span> <span class="o">=</span> <span class="n">model_name</span>  <span class="c1"># type(model).__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span> <span class="o">=</span> <span class="n">kfolds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span> <span class="o">=</span> <span class="n">model</span>

        <span class="c1"># Internals for reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_random_seed</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">random_seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scikitlearn_version</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">__version__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_and_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe_order</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Internal variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_scaling</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality_reduction</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_selection</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="n">param_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_order</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">model_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the model name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_name</span>

    <span class="nd">@model_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">model_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mname</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_name</span> <span class="o">=</span> <span class="n">mname</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="nd">@model_name</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">model_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Xtrain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the features for training</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span>

    <span class="nd">@Xtrain</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Xtrain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xtr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">xtr</span>

    <span class="nd">@Xtrain</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Xtrain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Xtest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the features for training</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span>

    <span class="nd">@Xtest</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Xtest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">xts</span>

    <span class="nd">@Xtest</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Xtest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ytrain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the target for training</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span>

    <span class="nd">@ytrain</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ytrain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ytr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">ytr</span>

    <span class="nd">@ytrain</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ytrain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ytest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the features for training</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span>

    <span class="nd">@Xtest</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Xtest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">xts</span>

    <span class="nd">@Xtest</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Xtest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a descriptive string of the class</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: string description of the class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Model: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> # train </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="kc">None</span><span class="si">}</span><span class="s2"> # test </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_test</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">X_test</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="si">}</span><span class="s2"> # validate </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_validate</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">X_validate</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="kc">None</span><span class="si">}</span><span class="s2"> sklearn version </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scikitlearn_version</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_default_pipe_order</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature_scaling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">dimensionality_reduction</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">feature_selection</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a dictionary setting the order of the elements of the pipeline</span>

<span class="sd">        Args:</span>
<span class="sd">            feature_scaling (int, optional): The order (1st 2nd 3rd .....) of the feature scaling element if any. Defaults to 1.</span>
<span class="sd">            dimensionality_reduction (int, optional): The order of the dimensionality reduction element if any. Defaults to 2.</span>
<span class="sd">            feature_selection (int, optional): The order of the feature selection element if any. Defaults to 3.</span>
<span class="sd">            model (int, optional): The order of the model element. Defaults to 4.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict : dictionary of element name to the order position of the elements for the pipeline</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;feature_scaling&quot;</span><span class="p">:</span> <span class="n">feature_scaling</span><span class="p">,</span>
            <span class="s2">&quot;dimensionality_reduction&quot;</span><span class="p">:</span> <span class="n">dimensionality_reduction</span><span class="p">,</span>
            <span class="s2">&quot;feature_selection&quot;</span><span class="p">:</span> <span class="n">feature_selection</span><span class="p">,</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build_train_test_validate_splits</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">smiles_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">task_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_column_regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">splitter_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">dc</span><span class="o">.</span><span class="n">splits</span><span class="o">.</span><span class="n">Splitter</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">train</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="n">test</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">holdout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">kfold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># TODO: set up for kfold</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a function to build the data splits into train test and validate sets</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame): All of the data in one dataframe to split into a dataset for ML/AI</span>
<span class="sd">            smiles_column (str): The column name that contains smiles strings</span>
<span class="sd">            task_columns (List[str]): List of y task column names</span>
<span class="sd">            feature_columns (Optional[List[str]], optional): Must provide this or feature_column_regex. If this is provided it is a list of the column names that correspond to features i.e. the X mat. Defaults to None.</span>
<span class="sd">            fesature_column_regex (Optional[str], optional): Must provide this or feature_columns. If this is provided it is a partial or full string to identify all columns that contain it as feature columns. Defaults to None.</span>
<span class="sd">            df (Optional[pd.DataFrame], optional): Dataframe to convert to a dataset and split. Please note the keyword args for this are passed through kwargs here, they correspond to the arguments for pandas_to_deepchem(). Defaults to None.</span>
<span class="sd">            train (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for training. Defaults to None.</span>
<span class="sd">            test (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for testing. Defaults to None.</span>
<span class="sd">            validation (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for validation. Defaults to None.</span>
<span class="sd">            _kfold (Optional[int], optional): The number of k fold splits. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RunTimeError: data is not found in the class and is not passed to the call</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">tmp_dat</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">pandas_to_deepchem</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span><span class="p">,</span>
                <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column</span><span class="p">,</span>
                <span class="n">task_columns</span><span class="o">=</span><span class="n">task_columns</span><span class="p">,</span>
                <span class="n">feature_columns</span><span class="o">=</span><span class="n">feature_columns</span><span class="p">,</span>
                <span class="n">feature_column_regex</span><span class="o">=</span><span class="n">feature_column_regex</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span> <span class="o">=</span> <span class="n">df</span>
            <span class="n">tmp_dat</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">pandas_to_deepchem</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span><span class="p">,</span>
                <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column</span><span class="p">,</span>
                <span class="n">task_columns</span><span class="o">=</span><span class="n">task_columns</span><span class="p">,</span>
                <span class="n">feature_columns</span><span class="o">=</span><span class="n">feature_columns</span><span class="p">,</span>
                <span class="n">feature_column_regex</span><span class="o">=</span><span class="n">feature_column_regex</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Data not found! Please set self.data_df or pass in a dataframe to this function.&quot;</span>
            <span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Training fraction </span><span class="si">{</span><span class="n">train</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="si">}</span><span class="s2"> Testing fraction </span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="si">}</span><span class="s2">validation fraction </span><span class="si">{</span><span class="n">holdout</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">holdout</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">holdout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kfold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">train</span><span class="p">,</span> <span class="n">holdout</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
                <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span>
                <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span>
                <span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">,</span>
                <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">,</span>
                <span class="n">holdout</span><span class="o">=</span><span class="n">holdout</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="n">holdout</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_validate</span> <span class="o">=</span> <span class="n">holdout</span><span class="o">.</span><span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_validate</span> <span class="o">=</span> <span class="n">holdout</span><span class="o">.</span><span class="n">y</span>

        <span class="k">elif</span> <span class="n">holdout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kfold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">splitter</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
                <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span>
                <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span>
                <span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">,</span>
                <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">,</span>
                <span class="n">holdout</span><span class="o">=</span><span class="n">holdout</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">y</span>

        <span class="k">elif</span> <span class="n">kfold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">holdout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2"> fold&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
                    <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span> <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span> <span class="n">kfold</span><span class="o">=</span><span class="n">kfold</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2"> fold and validation holdout&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
                        <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span>
                        <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span>
                        <span class="n">holdout</span><span class="o">=</span><span class="n">holdout</span><span class="p">,</span>
                        <span class="n">kfold</span><span class="o">=</span><span class="n">kfold</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">X_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">X</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Using SciKit-Learn random splitter you may want to consider using molecule splitters is this is for molecular data.&quot;</span>
            <span class="p">)</span>
            <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
                <span class="n">tmp_dat</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
                <span class="n">tmp_dat</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                <span class="n">random_state</span><span class="o">=</span><span class="n">helpers</span><span class="o">.</span><span class="n">random_seed</span><span class="p">,</span>
                <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span>

        <span class="k">if</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Train: </span><span class="si">{</span><span class="n">train</span><span class="si">}</span><span class="s2">, Validation: </span><span class="si">{</span><span class="n">holdout</span><span class="si">}</span><span class="s2">, Test </span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2">, kfolds: </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2">, splitter </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Train: </span><span class="si">{</span><span class="n">train</span><span class="si">}</span><span class="s2">, Validation: </span><span class="si">{</span><span class="n">holdout</span><span class="si">}</span><span class="s2">, Test </span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2">, kfolds: </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build_pipline_list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pipeline_element_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_scaling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dimensionality_reduction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_selection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function builds a list of sklearn pipeline elements. It is stored as list internally so that it can be modified. Once happy call</span>
<span class="sd">        self.make_pipeline to set the pipeline in the class. Note you can pass a pipeline and param_grid in to the class directly to use.</span>

<span class="sd">        Args:</span>
<span class="sd">            pipeline_element_order (_type_, optional): A dictionary of scikit learn pipeline steps with keys of &quot;feature_scaling&quot;,</span>
<span class="sd">            &quot;dimensionality_reduction&quot;, &quot;feature_selection&quot; and &quot;model&quot; and values of integers which set the order in which these steps will</span>
<span class="sd">            happen in the pipeline. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if an unknown step is trying to be added to the pipeline</span>

<span class="sd">        Returns:</span>
<span class="sd">            List: list of tuples of steps for the pipeline</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">pipeline_element_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">orders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_pipe_order</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipe_order</span> <span class="o">=</span> <span class="n">orders</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_pipe_order</span><span class="p">(</span><span class="o">**</span><span class="n">pipeline_element_order</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipe_order</span> <span class="o">=</span> <span class="n">orders</span>

        <span class="k">if</span> <span class="n">feature_scaling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_scaling</span> <span class="o">=</span> <span class="n">feature_scaling</span>

        <span class="k">if</span> <span class="n">dimensionality_reduction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality_reduction</span> <span class="o">=</span> <span class="n">dimensionality_reduction</span>

        <span class="k">if</span> <span class="n">feature_selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_selection</span> <span class="o">=</span> <span class="n">feature_selection</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">elt</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline element: </span><span class="si">{</span><span class="n">elt</span><span class="si">}</span><span class="s2"> in order </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;feature_scaling&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_scaling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added feature scaling to pipeline&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_scaling</span><span class="p">))</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;dimensionality_reduction&quot;</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality_reduction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added dimensionality reduction to pipeline&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality_reduction</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;feature_selection&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added feature selection to pipeline&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_selection</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;model&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added model to pipeline&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span>
                <span class="n">ent</span> <span class="o">!=</span> <span class="n">elt</span>
                <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s2">&quot;feature_scaling&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;dimensionality_reduction&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;feature_selection&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;model&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Unknown pipeline entry requested </span><span class="si">{</span><span class="n">elt</span><span class="si">}</span><span class="s2">. This class can only accept feature_scaling, dimensionality_reduction, feature_selection, model.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No </span><span class="si">{</span><span class="n">elt</span><span class="si">}</span><span class="s2"> in the pipeline&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">prepend_with</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to change the key names of a dictionary by prepending a constant string to them all.</span>

<span class="sd">        Args:</span>
<span class="sd">            d (dict): dictionary of key and value for grid searching hyper-parameter options</span>
<span class="sd">            prepend_with (str): The pipeline element to prepend the key with</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: updated dictionary so that the parameters related to a specific pipeline element are noted in the keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prepend_with</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="n">prepend_with</span> <span class="k">else</span> <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build_parameter_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature_scaling_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dimensionality_reduction_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_selection_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">model_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">add_prepends_for_pipe_to_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to build the parameter grid. It will by default prepend the pipeline step to the parameters as needed. Then it combines all input dictionaries, not there should not</span>
<span class="sd">        be any overlapping keys in the separete input dictionaries</span>

<span class="sd">        Args:</span>
<span class="sd">            feature_scaling_param_grid (Optional[dict], optional): dictionary of options for feature scaling (if any) in the model pipeline. Defaults to None.</span>
<span class="sd">            dimensionality_reduction_param_grid (Optional[dict], optional): dictionary of options for dimensionality reduction (if any) in the model pipeline. Defaults to None.</span>
<span class="sd">            feature_selection_param_grid (Optional[dict], optional): dictionary of options for feature selection (if any) in the model pipeline. Defaults to None.</span>
<span class="sd">            model_param_grid (Optional[dict], optional): dictionary of options for model hyper-parameters in the model pipeline. Defaults to None.</span>
<span class="sd">            add_prepends_for_pipe_to_all (bool, optional): Whether to add the pipeline element prepend lables to each key. Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">add_prepends_for_pipe_to_all</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_scaling_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">feature_scaling_param_grid</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                        <span class="n">feature_scaling_param_grid</span><span class="p">,</span> <span class="s2">&quot;feature_scaling&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dimensionality_reduction_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">dimensionality_reduction_param_grid</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                        <span class="n">dimensionality_reduction_param_grid</span><span class="p">,</span> <span class="s2">&quot;dimensionality_reduction&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_selection_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">feature_selection_param_grid</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                        <span class="n">feature_selection_param_grid</span><span class="p">,</span> <span class="s2">&quot;feature_selection&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">model_param_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                    <span class="n">model_param_grid</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span>
                <span class="p">)</span>

        <span class="c1"># NOTE: it assumes there are no overlapping keys but doesn&#39;t check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_scaling_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">feature_scaling_param_grid</span><span class="p">}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dimensionality_reduction_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">dimensionality_reduction_param_grid</span><span class="p">}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_selection_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">feature_selection_param_grid</span><span class="p">}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">model_param_grid</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_pipeline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to build a pipeline if the pipeline elements have been defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting the scikit learn pipeline using </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">return_pipeline</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Pipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;model.joblib&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the final model pipeline to a jobloib file</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): filename to save</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_pipeline_into_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;model.joblib&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a model pipeline into this class</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): joblib file to load the model pipeline from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_self</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the entire class as a pickle file</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): file name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
            <span class="n">pkl</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">optimize_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to train a model pipeline using the setting defined</span>

<span class="sd">        Args:</span>
<span class="sd">            cv (int, optional): The number of corss validation folds used to establish the best hyper-parameters. Defaults to 5.</span>
<span class="sd">            verbose (bool, optional): To print verbose or not trianing information. Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RXTrainTestGridSearchSklearnRegresssor</span><span class="p">(</span><span class="n">RXGridSearchSklearnRegresssor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for building a model using a single train test split. This class encapulates a generalized model building process.</span>
<span class="sd">    To fully optimze a model it will need to be taken put of this class. This is a method wrapper to enable several methods to be tested initially.</span>

<span class="sd">    It is expected that this class is used in the following manner:</span>
<span class="sd">    1. Load you data and featurize from your moleucle representation:</span>
<span class="sd">    ```</span>
<span class="sd">    df = pd.read_csv(&quot;my_data.csv)</span>
<span class="sd">    feat_df = featurization.get_count_ecfp(data_df=df, smiles_column=&quot;smiles&quot;, return_df=True)</span>
<span class="sd">    ```</span>

<span class="sd">    2. Select your scikit learn model and parameter grid. You can use the default models provided in this libray which provides name, model and parameter grid to search as follows:</span>
<span class="sd">    ```</span>
<span class="sd">    my_model = classical_ml_models.linear_models(lasso=False, lars=False)[0]</span>
<span class="sd">    ```</span>

<span class="sd">    Alternatively wrap up your chosen model:</span>

<span class="sd">    ```</span>
<span class="sd">    from chemutil.classical_ml_models import skmodel</span>

<span class="sd">    my_model = skmodel(</span>
<span class="sd">        type(RandomForestRegressor()).__name__,</span>
<span class="sd">        RandomForestRegressor(random_state=helpers.random_seed, n_jobs=-1),</span>
<span class="sd">        {</span>
<span class="sd">            &quot;n_estimators&quot;: [50, 100, 200],</span>
<span class="sd">            &quot;min_samples_split&quot;: [2, 4],</span>
<span class="sd">            &quot;ccp_alpha&quot;: [0.0, 0.05],</span>
<span class="sd">            &quot;max_features&quot;: [&quot;sqrt&quot;, &quot;log2&quot;, 1.0],</span>
<span class="sd">        },</span>
<span class="sd">        {},</span>
<span class="sd">        True,</span>
<span class="sd">        &quot;https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html&quot;,</span>
<span class="sd">        sklearn.__version__,</span>
<span class="sd">        datetime.now(),</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>


<span class="sd">    3. Instantiate this class and load the model and data into the class</span>
<span class="sd">    ```</span>
<span class="sd">    cls = RXGridSearchSklearnRegresssor(</span>
<span class="sd">        feat_df,</span>
<span class="sd">        model=linear_regression_models.model,</span>
<span class="sd">        model_name=linear_regression_models.name</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>

<span class="sd">    4. Set your data splits this example is based on train test splits and uses tye molecular weight splitter from deepchem</span>
<span class="sd">    ```</span>
<span class="sd">    cls.build_trian_test_validate_splits(</span>
<span class="sd">        smiles_column=&quot;smiles&quot;,</span>
<span class="sd">        task_columns=[&quot;taskX&quot;],</span>
<span class="sd">        feature_column_regex=&quot;ecfp_count_bit_&quot;,</span>
<span class="sd">        splitter_type=&quot;mw&quot;,</span>
<span class="sd">        train=0.8,</span>
<span class="sd">        test=0.2,</span>
<span class="sd">        validation=None</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>

<span class="sd">    5. Define your sklearn pipeline to include, in addition to the model, any of the following elements feature_scaling, dimensionality_reduction or feature_selection. provide the word &quot;passthrough&quot; to activate this</span>
<span class="sd">    element or if you are fixing to just one method you can add that directly i.e. feature_scaling=MinMaxScaler(). Following this define the parameter grid to search. if you have activated any of the optional pipeline</span>
<span class="sd">    elements if you have activated an element with &quot;passthrough&quot; you must provide a key of the element mapping to the method eg {&quot;feature_scaling&quot;: MinMaxScaler()}. You can then extend the dictionary with</span>
<span class="sd">    hyper-parameters to try i.e. &quot;dimensionality_reduction&quot;: PCA(), &quot;n_components&quot;: [2, 3, 4], &quot;iterated_power&quot;: [2, 5, 7]}. For the model provide a dictionary of hyper parameters to grid search, not the dafualt models</span>
<span class="sd">    in this library have a grid which can be used by default.</span>

<span class="sd">    ```</span>
<span class="sd">    model.build_pipline_list(feature_scaling=&quot;passthrough&quot;)</span>
<span class="sd">    cls.build_parameter_grid(</span>
<span class="sd">        feature_scaling_param_grid={&quot;feature_scaling&quot;: [MinMaxScaler(), StandardScaler()]},</span>
<span class="sd">        model_param_grid=my_model.default_param_grid</span>
<span class="sd">    )</span>
<span class="sd">    cls.make_pipeline()</span>
<span class="sd">    ```</span>

<span class="sd">    6. You can now eun the grid search, defining scoring functions to use. Note the first one is used to identify the best model and refit</span>
<span class="sd">    ```</span>
<span class="sd">    gs = cls.optimize_model(scoring=(&quot;neg_root_mean_squared_error&quot;, &quot;r2&quot;))</span>
<span class="sd">    ```</span>

<span class="sd">    Args:</span>
<span class="sd">        RXGridSearchSklearnRegresssor (_type_): _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">optimize_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cv</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">scoring</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">refit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">return_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to train a model pipeline using the setting defined</span>

<span class="sd">        Args:</span>
<span class="sd">            cv (int, optional): The number of corss validation folds used to establish the best hyper-parameters. Defaults to 5.</span>
<span class="sd">            verbose (bool, optional): To print verbose or not trianing information. Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Will use the parameter grid: </span><span class="si">{</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Will run the following pipeline to optimize the hyper parmaeters&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using the trianing data to run a Grid search CV&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scoring</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scoring</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;neg_mean_squared_error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;neg_root_mean_squared_error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;neg_mean_absolute_percentage_error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;r2&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using default scoring: </span><span class="si">{</span><span class="n">scoring</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">refit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">refit</span> <span class="o">=</span> <span class="n">scoring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span>
            <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span>
            <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">completed_grid_search</span> <span class="o">=</span> <span class="n">grid_search</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_parmeters</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>

        <span class="k">if</span> <span class="n">return_model</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">grid_search</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RXKFoldGridSearchSklearnRegresssor</span><span class="p">(</span><span class="n">RXGridSearchSklearnRegresssor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for building a model using a k fold split and holdout set. This class encapulates a generalized model building process.</span>
<span class="sd">    To fully optimze a model it will need to be taken put of this class. This is a method wrapper to enable several methods to be tested initially.</span>

<span class="sd">    It is expected that this class is used in the following manner:</span>
<span class="sd">    1. Load you data and featurize from your moleucle representation:</span>
<span class="sd">    ```</span>
<span class="sd">    df = pd.read_csv(&quot;my_data.csv)</span>
<span class="sd">    feat_df = featurization.get_count_ecfp(data_df=df, smiles_column=&quot;smiles&quot;, return_df=True)</span>
<span class="sd">    ```</span>

<span class="sd">    2. Select your scikit learn model and parameter grid. You can use the default models provided in this libray which provides name, model and parameter grid to search as follows:</span>
<span class="sd">    ```</span>
<span class="sd">    my_model = classical_ml_models.linear_models(lasso=False, lars=False)[0]</span>
<span class="sd">    ```</span>

<span class="sd">    Alternatively wrap up your chosen model:</span>

<span class="sd">    ```</span>
<span class="sd">    from chemutil.classical_ml_models import skmodel</span>

<span class="sd">    my_model = skmodel(</span>
<span class="sd">        type(RandomForestRegressor()).__name__,</span>
<span class="sd">        RandomForestRegressor(random_state=helpers.random_seed, n_jobs=-1),</span>
<span class="sd">        {</span>
<span class="sd">            &quot;n_estimators&quot;: [50, 100, 200],</span>
<span class="sd">            &quot;min_samples_split&quot;: [2, 4],</span>
<span class="sd">            &quot;ccp_alpha&quot;: [0.0, 0.05],</span>
<span class="sd">            &quot;max_features&quot;: [&quot;sqrt&quot;, &quot;log2&quot;, 1.0],</span>
<span class="sd">        },</span>
<span class="sd">        {},</span>
<span class="sd">        True,</span>
<span class="sd">        &quot;https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html&quot;,</span>
<span class="sd">        sklearn.__version__,</span>
<span class="sd">        datetime.now(),</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>


<span class="sd">    3. Instantiate this class and load the model and data into the class</span>
<span class="sd">    ```</span>
<span class="sd">    cls = RXGridSearchSklearnRegresssor(</span>
<span class="sd">        feat_df,</span>
<span class="sd">        model=linear_regression_models.model,</span>
<span class="sd">        model_name=linear_regression_models.name</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>

<span class="sd">    4. Set your data splits this example is based on train test splits and uses tye molecular weight splitter from deepchem</span>
<span class="sd">    ```</span>
<span class="sd">    cls.build_trian_test_validate_splits(</span>
<span class="sd">        smiles_column=&quot;smiles&quot;,</span>
<span class="sd">        task_columns=[&quot;taskX&quot;],</span>
<span class="sd">        feature_column_regex=&quot;ecfp_count_bit_&quot;,</span>
<span class="sd">        splitter_type=&quot;mw&quot;,</span>
<span class="sd">        train=0.8,</span>
<span class="sd">        test=0.2,</span>
<span class="sd">        validation=None</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>

<span class="sd">    5. Define your sklearn pipeline to include, in addition to the model, any of the following elements feature_scaling, dimensionality_reduction or feature_selection. provide the word &quot;passthrough&quot; to activate this</span>
<span class="sd">    element or if you are fixing to just one method you can add that directly i.e. feature_scaling=MinMaxScaler(). Following this define the parameter grid to search. if you have activated any of the optional pipeline</span>
<span class="sd">    elements if you have activated an element with &quot;passthrough&quot; you must provide a key of the element mapping to the method eg {&quot;feature_scaling&quot;: MinMaxScaler()}. You can then extend the dictionary with</span>
<span class="sd">    hyper-parameters to try i.e. &quot;dimensionality_reduction&quot;: PCA(), &quot;n_components&quot;: [2, 3, 4], &quot;iterated_power&quot;: [2, 5, 7]}. For the model provide a dictionary of hyper parameters to grid search, not the dafualt models</span>
<span class="sd">    in this library have a grid which can be used by default.</span>

<span class="sd">    ```</span>
<span class="sd">    model.build_pipline_list(feature_scaling=&quot;passthrough&quot;)</span>
<span class="sd">    cls.build_parameter_grid(</span>
<span class="sd">        feature_scaling_param_grid={&quot;feature_scaling&quot;: [MinMaxScaler(), StandardScaler()]},</span>
<span class="sd">        model_param_grid=my_model.default_param_grid</span>
<span class="sd">    )</span>
<span class="sd">    cls.make_pipeline()</span>
<span class="sd">    ```</span>

<span class="sd">    6. You can now eun the grid search, defining scoring functions to use. Note the first one is used to identify the best model and refit</span>
<span class="sd">    ```</span>
<span class="sd">    gs = cls.optimize_model(scoring=(&quot;neg_root_mean_squared_error&quot;, &quot;r2&quot;))</span>
<span class="sd">    ```</span>

<span class="sd">    Args:</span>
<span class="sd">        RXGridSearchSklearnRegresssor (_type_): _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">optimize_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">grid_cv</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">scoring</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">refit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">return_gs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to train a model pipeline using the setting defined</span>

<span class="sd">        Args:</span>
<span class="sd">            grid_cv (int, optional): The number of corss validation folds used to establish the best hyper-parameters. Defaults to 5.</span>
<span class="sd">            verbose (bool, optional): To print verbose or not trianing information. Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;This method will fit k modles on the data avaliable (exluding holdout validation data). This is done over k folds i.e. one model is trained using the best hyper-parameters found for each fold. The returned model must be evaluated on unseen held out data.&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Will use the parameter grid: </span><span class="si">{</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Will run the following pipeline to optimize the hyper parmaeters&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using the trianing data to run a Grid search CV&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scoring</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scoring</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;neg_mean_squared_error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;neg_root_mean_squared_error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;neg_mean_absolute_percentage_error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;r2&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using default scoring: </span><span class="si">{</span><span class="n">scoring</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">refit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">refit</span> <span class="o">=</span> <span class="n">scoring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">model_ensemble</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_grid_search</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ith</span><span class="p">,</span> <span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ith</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">train</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">test</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">pl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_pipeline</span><span class="p">(</span><span class="n">return_pipeline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
                <span class="n">pl</span><span class="p">,</span>
                <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span>
                <span class="n">cv</span><span class="o">=</span><span class="n">grid_cv</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span>
                <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">completed_grid_search</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid_search</span><span class="p">)</span>
            <span class="n">model_ensemble</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;model_</span><span class="si">{</span><span class="n">ith</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">return_gs</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">model_ensemble</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">VotingRegressor</span><span class="p">(</span><span class="n">model_ensemble</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">expected_n_data</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">])</span>
            <span class="n">X_all_kf_data_concatenated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">])</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All X concatenate: </span><span class="si">{</span><span class="n">X_all_kf_data_concatenated</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">y_all_kf_data_concatenated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">])</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All y concatenate: </span><span class="si">{</span><span class="n">y_all_kf_data_concatenated</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="n">ent</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_n_data</span>
                    <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span><span class="n">X_all_kf_data_concatenated</span><span class="p">,</span> <span class="n">y_all_kf_data_concatenated</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">aerr</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">aerr</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;ERROR - concatenating all kfold data for final fit leads to unequal number of dat points: expected: </span><span class="si">{</span><span class="n">expected_n_data</span><span class="si">}</span><span class="s2"> X data </span><span class="si">{</span><span class="n">X_all_kf_data_concatenated</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> y data </span><span class="si">{</span><span class="n">y_all_kf_data_concatenated</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_all_kf_data_concatenated</span><span class="p">,</span> <span class="n">y_all_kf_data_concatenated</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_all_kf_data_concatenated</span><span class="p">,</span> <span class="n">y_all_kf_data_concatenated</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">m</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">grid_search</span>


<span class="k">def</span><span class="w"> </span><span class="nf">dc_sklearn_model_builder</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="chemutil.classical_ml_model_build.log" class="name">var <span class="ident">log</span></p>


  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>

  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.dc_sklearn_model_builder">
    <p>def <span class="ident">dc_sklearn_model_builder</span>(</p><p>)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.dc_sklearn_model_builder', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.dc_sklearn_model_builder" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">dc_sklearn_model_builder</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.get_pearson_r">
    <p>def <span class="ident">get_pearson_r</span>(</p><p>x: numpy.ndarray, y: numpy.ndarray)</p>
    </div>




    <div class="desc"><p>Function which can be ysed to make a Pearson R scorer</p>
<p>Args:
    x (numpy.ndarray): Data for the Pearson R correlation from one source
    y (numpy.ndarray): Data for the Pearson R correlation from another source</p>
<p>Returns:
    float: Pearson R metric</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.get_pearson_r', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.get_pearson_r" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_pearson_r</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function which can be ysed to make a Pearson R scorer</span>

<span class="sd">    Args:</span>
<span class="sd">        x (numpy.ndarray): Data for the Pearson R correlation from one source</span>
<span class="sd">        y (numpy.ndarray): Data for the Pearson R correlation from another source</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Pearson R metric</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span>
</pre></div>

  </div>
</div>

  </div>


    <h2 class="section-title" id="header-classes">Classes</h2>

      <div class="item">
      <p id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor" class="name">class <span class="ident">RXGridSearchSklearnRegresssor</span></p>


    <div class="desc"><p>A class to encapulate the model building process for scikit learn classical ML models using a train test and validate data splitting</p>
<p>The idea of this class is to wrap up the sklearn pipeline model building and training in a single container which can be saved.</p>
<p>For examples and information see the notebooks directory</p>
<p>It is expected that this class is used in the following manner:
1. Load you data and featurize from your moleucle representation:</p>
<pre><code>df = pd.read_csv(&quot;my_data.csv)
feat_df = featurization.get_count_ecfp(data_df=df, smiles_column=&quot;smiles&quot;, return_df=True)
</code></pre>
<ol>
<li>Select your scikit learn model and parameter grid. You can use the default models provided in this libray which provides name, model and parameter grid to search as follows:</li>
</ol>
<pre><code>my_model = classical_ml_models.linear_models(lasso=False, lars=False)[0]
</code></pre>
<p>Alternatively wrap up your chosen model:</p>
<pre><code>from chemutil.classical_ml_models import skmodel

my_model = skmodel(
    type(RandomForestRegressor()).__name__,
    RandomForestRegressor(random_state=helpers.random_seed, n_jobs=-1),
    {
        &quot;n_estimators&quot;: [50, 100, 200],
        &quot;min_samples_split&quot;: [2, 4],
        &quot;ccp_alpha&quot;: [0.0, 0.05],
        &quot;max_features&quot;: [&quot;sqrt&quot;, &quot;log2&quot;, 1.0],
    },
    {},
    True,
    &quot;https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html&quot;,
    sklearn.__version__,
    datetime.now(),
)
</code></pre>
<ol>
<li>Instantiate this class and load the model and data into the class</li>
</ol>
<pre><code>cls = RXGridSearchSklearnRegresssor(
    feat_df,
    model=linear_regression_models.model,
    model_name=linear_regression_models.name
)
</code></pre>
<ol>
<li>Set your data splits this example is based on train test splits and uses tye molecular weight splitter from deepchem</li>
</ol>
<pre><code>cls.build_trian_test_validate_splits(
    smiles_column=&quot;smiles&quot;,
    task_columns=[&quot;taskX&quot;],
    feature_column_regex=&quot;ecfp_count_bit_&quot;,
    splitter_type=&quot;mw&quot;,
    train=0.8,
    test=0.2,
    validation=None
)
</code></pre>
<ol>
<li>Define your sklearn pipeline to include, in addition to the model, any of the following elements feature_scaling, dimensionality_reduction or feature_selection. provide the word "passthrough" to activate this
element or if you are fixing to just one method you can add that directly i.e. feature_scaling=MinMaxScaler(). Following this define the parameter grid to search. if you have activated any of the optional pipeline
elements if you have activated an element with "passthrough" you must provide a key of the element mapping to the method eg {"feature_scaling": MinMaxScaler()}. You can then extend the dictionary with
hyper-parameters to try i.e. "dimensionality_reduction": PCA(), "n_components": [2, 3, 4], "iterated_power": [2, 5, 7]}. For the model provide a dictionary of hyper parameters to grid search, not the dafualt models
in this library have a grid which can be used by default.</li>
</ol>
<pre><code>model.build_pipline_list(feature_scaling=&quot;passthrough&quot;)
cls.build_parameter_grid(
    feature_scaling_param_grid={&quot;feature_scaling&quot;: [MinMaxScaler(), StandardScaler()]},
    model_param_grid=my_model.default_param_grid
)
cls.make_pipeline()
</code></pre>
<ol>
<li>You can now eun the grid search, defining scoring functions to use. Note the first one is used to identify the best model and refit</li>
</ol>
<pre><code>gs = cls.optimize_model(scoring=(&quot;neg_root_mean_squared_error&quot;, &quot;r2&quot;))
</code></pre></div>
  <div class="source_cont">
</div>


      <div class="class">
          <h3>Class variables</h3>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.log" class="name">var <span class="ident">log</span></p>




  <div class="source_cont">
</div>

            </div>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.Xtest" class="name">var <span class="ident">Xtest</span></p>




    <div class="desc"><p>Set the features for training</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.Xtrain" class="name">var <span class="ident">Xtrain</span></p>




    <div class="desc"><p>Set the features for training</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.model_name" class="name">var <span class="ident">model_name</span></p>




    <div class="desc"><p>Set the model name</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.ytest" class="name">var <span class="ident">ytest</span></p>




    <div class="desc"><p>Set the features for training</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.ytrain" class="name">var <span class="ident">ytrain</span></p>




    <div class="desc"><p>Set the target for training</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>

  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_parameter_grid">
    <p>def <span class="ident">build_parameter_grid</span>(</p><p>self, feature_scaling_param_grid: Optional[dict] = None, dimensionality_reduction_param_grid: Optional[dict] = None, feature_selection_param_grid: Optional[dict] = None, model_param_grid: Optional[dict] = None, add_prepends_for_pipe_to_all: bool = True)</p>
    </div>




    <div class="desc"><p>Function to build the parameter grid. It will by default prepend the pipeline step to the parameters as needed. Then it combines all input dictionaries, not there should not
be any overlapping keys in the separete input dictionaries</p>
<p>Args:
    feature_scaling_param_grid (Optional[dict], optional): dictionary of options for feature scaling (if any) in the model pipeline. Defaults to None.
    dimensionality_reduction_param_grid (Optional[dict], optional): dictionary of options for dimensionality reduction (if any) in the model pipeline. Defaults to None.
    feature_selection_param_grid (Optional[dict], optional): dictionary of options for feature selection (if any) in the model pipeline. Defaults to None.
    model_param_grid (Optional[dict], optional): dictionary of options for model hyper-parameters in the model pipeline. Defaults to None.
    add_prepends_for_pipe_to_all (bool, optional): Whether to add the pipeline element prepend lables to each key. Defaults to True.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_parameter_grid', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_parameter_grid" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_parameter_grid</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">feature_scaling_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dimensionality_reduction_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_selection_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">add_prepends_for_pipe_to_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to build the parameter grid. It will by default prepend the pipeline step to the parameters as needed. Then it combines all input dictionaries, not there should not</span>
<span class="sd">    be any overlapping keys in the separete input dictionaries</span>
<span class="sd">    Args:</span>
<span class="sd">        feature_scaling_param_grid (Optional[dict], optional): dictionary of options for feature scaling (if any) in the model pipeline. Defaults to None.</span>
<span class="sd">        dimensionality_reduction_param_grid (Optional[dict], optional): dictionary of options for dimensionality reduction (if any) in the model pipeline. Defaults to None.</span>
<span class="sd">        feature_selection_param_grid (Optional[dict], optional): dictionary of options for feature selection (if any) in the model pipeline. Defaults to None.</span>
<span class="sd">        model_param_grid (Optional[dict], optional): dictionary of options for model hyper-parameters in the model pipeline. Defaults to None.</span>
<span class="sd">        add_prepends_for_pipe_to_all (bool, optional): Whether to add the pipeline element prepend lables to each key. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">add_prepends_for_pipe_to_all</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_scaling_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">feature_scaling_param_grid</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                    <span class="n">feature_scaling_param_grid</span><span class="p">,</span> <span class="s2">&quot;feature_scaling&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dimensionality_reduction_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">dimensionality_reduction_param_grid</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                    <span class="n">dimensionality_reduction_param_grid</span><span class="p">,</span> <span class="s2">&quot;dimensionality_reduction&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_selection_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">feature_selection_param_grid</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                    <span class="n">feature_selection_param_grid</span><span class="p">,</span> <span class="s2">&quot;feature_selection&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">model_param_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                <span class="n">model_param_grid</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span>
            <span class="p">)</span>
    <span class="c1"># NOTE: it assumes there are no overlapping keys but doesn&#39;t check</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_scaling_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">feature_scaling_param_grid</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dimensionality_reduction_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">dimensionality_reduction_param_grid</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_selection_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">feature_selection_param_grid</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">model_param_grid</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_pipline_list">
    <p>def <span class="ident">build_pipline_list</span>(</p><p>self, pipeline_element_order=None, feature_scaling: Union[List[str], Callable, str, NoneType] = None, dimensionality_reduction: Union[List[str], Callable, str, NoneType] = None, feature_selection: Union[List[str], Callable, str, NoneType] = None)</p>
    </div>




    <div class="desc"><p>This function builds a list of sklearn pipeline elements. It is stored as list internally so that it can be modified. Once happy call
self.make_pipeline to set the pipeline in the class. Note you can pass a pipeline and param_grid in to the class directly to use.</p>
<p>Args:
    pipeline_element_order (<em>type</em>, optional): A dictionary of scikit learn pipeline steps with keys of "feature_scaling",
    "dimensionality_reduction", "feature_selection" and "model" and values of integers which set the order in which these steps will
    happen in the pipeline. Defaults to None.</p>
<p>Raises:
    ValueError: if an unknown step is trying to be added to the pipeline</p>
<p>Returns:
    List: list of tuples of steps for the pipeline</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_pipline_list', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_pipline_list" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_pipline_list</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">pipeline_element_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_scaling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dimensionality_reduction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_selection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function builds a list of sklearn pipeline elements. It is stored as list internally so that it can be modified. Once happy call</span>
<span class="sd">    self.make_pipeline to set the pipeline in the class. Note you can pass a pipeline and param_grid in to the class directly to use.</span>
<span class="sd">    Args:</span>
<span class="sd">        pipeline_element_order (_type_, optional): A dictionary of scikit learn pipeline steps with keys of &quot;feature_scaling&quot;,</span>
<span class="sd">        &quot;dimensionality_reduction&quot;, &quot;feature_selection&quot; and &quot;model&quot; and values of integers which set the order in which these steps will</span>
<span class="sd">        happen in the pipeline. Defaults to None.</span>
<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if an unknown step is trying to be added to the pipeline</span>
<span class="sd">    Returns:</span>
<span class="sd">        List: list of tuples of steps for the pipeline</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pipeline_element_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">orders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_pipe_order</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe_order</span> <span class="o">=</span> <span class="n">orders</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">orders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_pipe_order</span><span class="p">(</span><span class="o">**</span><span class="n">pipeline_element_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe_order</span> <span class="o">=</span> <span class="n">orders</span>
    <span class="k">if</span> <span class="n">feature_scaling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_scaling</span> <span class="o">=</span> <span class="n">feature_scaling</span>
    <span class="k">if</span> <span class="n">dimensionality_reduction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality_reduction</span> <span class="o">=</span> <span class="n">dimensionality_reduction</span>
    <span class="k">if</span> <span class="n">feature_selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_selection</span> <span class="o">=</span> <span class="n">feature_selection</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">elt</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline element: </span><span class="si">{</span><span class="n">elt</span><span class="si">}</span><span class="s2"> in order </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;feature_scaling&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_scaling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added feature scaling to pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_scaling</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;dimensionality_reduction&quot;</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality_reduction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added dimensionality reduction to pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality_reduction</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;feature_selection&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added feature selection to pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_selection</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;model&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added model to pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">ent</span> <span class="o">!=</span> <span class="n">elt</span>
            <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;feature_scaling&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dimensionality_reduction&quot;</span><span class="p">,</span>
                <span class="s2">&quot;feature_selection&quot;</span><span class="p">,</span>
                <span class="s2">&quot;model&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown pipeline entry requested </span><span class="si">{</span><span class="n">elt</span><span class="si">}</span><span class="s2">. This class can only accept feature_scaling, dimensionality_reduction, feature_selection, model.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No </span><span class="si">{</span><span class="n">elt</span><span class="si">}</span><span class="s2"> in the pipeline&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_train_test_validate_splits">
    <p>def <span class="ident">build_train_test_validate_splits</span>(</p><p>self, smiles_column: Optional[str] = None, task_columns: Optional[List[str]] = None, df: Optional[pandas.core.frame.DataFrame] = None, feature_columns: Optional[List[str]] = None, feature_column_regex: Optional[str] = None, splitter_type: Union[str, deepchem.splits.splitters.Splitter, NoneType] = None, train: Union[float, int, NoneType] = 0.8, test: Union[float, int, NoneType] = 0.1, holdout: Union[float, int, NoneType] = 0.1, kfold: Optional[int] = None, **kwargs)</p>
    </div>




    <div class="desc"><p>This is a function to build the data splits into train test and validate sets</p>
<p>Args:
    df (pd.DataFrame): All of the data in one dataframe to split into a dataset for ML/AI
    smiles_column (str): The column name that contains smiles strings
    task_columns (List[str]): List of y task column names
    feature_columns (Optional[List[str]], optional): Must provide this or feature_column_regex. If this is provided it is a list of the column names that correspond to features i.e. the X mat. Defaults to None.
    fesature_column_regex (Optional[str], optional): Must provide this or feature_columns. If this is provided it is a partial or full string to identify all columns that contain it as feature columns. Defaults to None.
    df (Optional[pd.DataFrame], optional): Dataframe to convert to a dataset and split. Please note the keyword args for this are passed through kwargs here, they correspond to the arguments for pandas_to_deepchem(). Defaults to None.
    train (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for training. Defaults to None.
    test (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for testing. Defaults to None.
    validation (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for validation. Defaults to None.
    _kfold (Optional[int], optional): The number of k fold splits. Defaults to None.</p>
<p>Raises:
    RunTimeError: data is not found in the class and is not passed to the call</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_train_test_validate_splits', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_train_test_validate_splits" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_train_test_validate_splits</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">smiles_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">task_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_column_regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">splitter_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">dc</span><span class="o">.</span><span class="n">splits</span><span class="o">.</span><span class="n">Splitter</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">train</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="n">test</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">holdout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">kfold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># TODO: set up for kfold</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a function to build the data splits into train test and validate sets</span>
<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): All of the data in one dataframe to split into a dataset for ML/AI</span>
<span class="sd">        smiles_column (str): The column name that contains smiles strings</span>
<span class="sd">        task_columns (List[str]): List of y task column names</span>
<span class="sd">        feature_columns (Optional[List[str]], optional): Must provide this or feature_column_regex. If this is provided it is a list of the column names that correspond to features i.e. the X mat. Defaults to None.</span>
<span class="sd">        fesature_column_regex (Optional[str], optional): Must provide this or feature_columns. If this is provided it is a partial or full string to identify all columns that contain it as feature columns. Defaults to None.</span>
<span class="sd">        df (Optional[pd.DataFrame], optional): Dataframe to convert to a dataset and split. Please note the keyword args for this are passed through kwargs here, they correspond to the arguments for pandas_to_deepchem(). Defaults to None.</span>
<span class="sd">        train (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for training. Defaults to None.</span>
<span class="sd">        test (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for testing. Defaults to None.</span>
<span class="sd">        validation (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for validation. Defaults to None.</span>
<span class="sd">        _kfold (Optional[int], optional): The number of k fold splits. Defaults to None.</span>
<span class="sd">    Raises:</span>
<span class="sd">        RunTimeError: data is not found in the class and is not passed to the call</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">tmp_dat</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">pandas_to_deepchem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span><span class="p">,</span>
            <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column</span><span class="p">,</span>
            <span class="n">task_columns</span><span class="o">=</span><span class="n">task_columns</span><span class="p">,</span>
            <span class="n">feature_columns</span><span class="o">=</span><span class="n">feature_columns</span><span class="p">,</span>
            <span class="n">feature_column_regex</span><span class="o">=</span><span class="n">feature_column_regex</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">tmp_dat</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">pandas_to_deepchem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span><span class="p">,</span>
            <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column</span><span class="p">,</span>
            <span class="n">task_columns</span><span class="o">=</span><span class="n">task_columns</span><span class="p">,</span>
            <span class="n">feature_columns</span><span class="o">=</span><span class="n">feature_columns</span><span class="p">,</span>
            <span class="n">feature_column_regex</span><span class="o">=</span><span class="n">feature_column_regex</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Data not found! Please set self.data_df or pass in a dataframe to this function.&quot;</span>
        <span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Training fraction </span><span class="si">{</span><span class="n">train</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="si">}</span><span class="s2"> Testing fraction </span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="si">}</span><span class="s2">validation fraction </span><span class="si">{</span><span class="n">holdout</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">holdout</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">holdout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kfold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">train</span><span class="p">,</span> <span class="n">holdout</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
            <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span>
            <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span>
            <span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">,</span>
            <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">,</span>
            <span class="n">holdout</span><span class="o">=</span><span class="n">holdout</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="n">holdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_validate</span> <span class="o">=</span> <span class="n">holdout</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_validate</span> <span class="o">=</span> <span class="n">holdout</span><span class="o">.</span><span class="n">y</span>
    <span class="k">elif</span> <span class="n">holdout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kfold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">splitter</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
            <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span>
            <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span>
            <span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">,</span>
            <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">,</span>
            <span class="n">holdout</span><span class="o">=</span><span class="n">holdout</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">y</span>
    <span class="k">elif</span> <span class="n">kfold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">holdout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2"> fold&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
                <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span> <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span> <span class="n">kfold</span><span class="o">=</span><span class="n">kfold</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2"> fold and validation holdout&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
                    <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span>
                    <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span>
                    <span class="n">holdout</span><span class="o">=</span><span class="n">holdout</span><span class="p">,</span>
                    <span class="n">kfold</span><span class="o">=</span><span class="n">kfold</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">y</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Using SciKit-Learn random splitter you may want to consider using molecule splitters is this is for molecular data.&quot;</span>
        <span class="p">)</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
            <span class="n">tmp_dat</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
            <span class="n">tmp_dat</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
            <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="n">helpers</span><span class="o">.</span><span class="n">random_seed</span><span class="p">,</span>
            <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span>
    <span class="k">if</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Train: </span><span class="si">{</span><span class="n">train</span><span class="si">}</span><span class="s2">, Validation: </span><span class="si">{</span><span class="n">holdout</span><span class="si">}</span><span class="s2">, Test </span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2">, kfolds: </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2">, splitter </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Train: </span><span class="si">{</span><span class="n">train</span><span class="si">}</span><span class="s2">, Validation: </span><span class="si">{</span><span class="n">holdout</span><span class="si">}</span><span class="s2">, Test </span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2">, kfolds: </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.load_pipeline_into_class">
    <p>def <span class="ident">load_pipeline_into_class</span>(</p><p>self, filename: str = &#39;model.joblib&#39;)</p>
    </div>




    <div class="desc"><p>Load a model pipeline into this class</p>
<p>Args:
    filename (str): joblib file to load the model pipeline from</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.load_pipeline_into_class', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.load_pipeline_into_class" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load_pipeline_into_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;model.joblib&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a model pipeline into this class</span>
<span class="sd">    Args:</span>
<span class="sd">        filename (str): joblib file to load the model pipeline from</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.make_pipeline">
    <p>def <span class="ident">make_pipeline</span>(</p><p>self, return_pipeline: bool = False)</p>
    </div>




    <div class="desc"><p>Function to build a pipeline if the pipeline elements have been defined</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.make_pipeline', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.make_pipeline" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">make_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_pipeline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to build a pipeline if the pipeline elements have been defined</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting the scikit learn pipeline using </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_pipeline</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Pipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.optimize_model">
    <p>def <span class="ident">optimize_model</span>(</p><p>self)</p>
    </div>




    <div class="desc"><p>Function to train a model pipeline using the setting defined</p>
<p>Args:
    cv (int, optional): The number of corss validation folds used to establish the best hyper-parameters. Defaults to 5.
    verbose (bool, optional): To print verbose or not trianing information. Defaults to True.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.optimize_model', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.optimize_model" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">optimize_model</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to train a model pipeline using the setting defined</span>
<span class="sd">    Args:</span>
<span class="sd">        cv (int, optional): The number of corss validation folds used to establish the best hyper-parameters. Defaults to 5.</span>
<span class="sd">        verbose (bool, optional): To print verbose or not trianing information. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.save_model">
    <p>def <span class="ident">save_model</span>(</p><p>self, filename: str = &#39;model.joblib&#39;)</p>
    </div>




    <div class="desc"><p>Save the final model pipeline to a jobloib file</p>
<p>Args:
    filename (str): filename to save</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.save_model', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.save_model" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;model.joblib&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the final model pipeline to a jobloib file</span>
<span class="sd">    Args:</span>
<span class="sd">        filename (str): filename to save</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.save_self">
    <p>def <span class="ident">save_self</span>(</p><p>self, filename: str)</p>
    </div>




    <div class="desc"><p>Save the entire class as a pickle file</p>
<p>Args:
    filename (str): file name</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.save_self', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.save_self" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">save_self</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the entire class as a pickle file</span>
<span class="sd">    Args:</span>
<span class="sd">        filename (str): file name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
        <span class="n">pkl</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>

      </div>
      </div>

      <div class="item">
      <p id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor" class="name">class <span class="ident">RXKFoldGridSearchSklearnRegresssor</span></p>


    <div class="desc"><p>Class for building a model using a k fold split and holdout set. This class encapulates a generalized model building process.
To fully optimze a model it will need to be taken put of this class. This is a method wrapper to enable several methods to be tested initially.</p>
<p>It is expected that this class is used in the following manner:
1. Load you data and featurize from your moleucle representation:</p>
<pre><code>df = pd.read_csv(&quot;my_data.csv)
feat_df = featurization.get_count_ecfp(data_df=df, smiles_column=&quot;smiles&quot;, return_df=True)
</code></pre>
<ol>
<li>Select your scikit learn model and parameter grid. You can use the default models provided in this libray which provides name, model and parameter grid to search as follows:</li>
</ol>
<pre><code>my_model = classical_ml_models.linear_models(lasso=False, lars=False)[0]
</code></pre>
<p>Alternatively wrap up your chosen model:</p>
<pre><code>from chemutil.classical_ml_models import skmodel

my_model = skmodel(
    type(RandomForestRegressor()).__name__,
    RandomForestRegressor(random_state=helpers.random_seed, n_jobs=-1),
    {
        &quot;n_estimators&quot;: [50, 100, 200],
        &quot;min_samples_split&quot;: [2, 4],
        &quot;ccp_alpha&quot;: [0.0, 0.05],
        &quot;max_features&quot;: [&quot;sqrt&quot;, &quot;log2&quot;, 1.0],
    },
    {},
    True,
    &quot;https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html&quot;,
    sklearn.__version__,
    datetime.now(),
)
</code></pre>
<ol>
<li>Instantiate this class and load the model and data into the class</li>
</ol>
<pre><code>cls = RXGridSearchSklearnRegresssor(
    feat_df,
    model=linear_regression_models.model,
    model_name=linear_regression_models.name
)
</code></pre>
<ol>
<li>Set your data splits this example is based on train test splits and uses tye molecular weight splitter from deepchem</li>
</ol>
<pre><code>cls.build_trian_test_validate_splits(
    smiles_column=&quot;smiles&quot;,
    task_columns=[&quot;taskX&quot;],
    feature_column_regex=&quot;ecfp_count_bit_&quot;,
    splitter_type=&quot;mw&quot;,
    train=0.8,
    test=0.2,
    validation=None
)
</code></pre>
<ol>
<li>Define your sklearn pipeline to include, in addition to the model, any of the following elements feature_scaling, dimensionality_reduction or feature_selection. provide the word "passthrough" to activate this
element or if you are fixing to just one method you can add that directly i.e. feature_scaling=MinMaxScaler(). Following this define the parameter grid to search. if you have activated any of the optional pipeline
elements if you have activated an element with "passthrough" you must provide a key of the element mapping to the method eg {"feature_scaling": MinMaxScaler()}. You can then extend the dictionary with
hyper-parameters to try i.e. "dimensionality_reduction": PCA(), "n_components": [2, 3, 4], "iterated_power": [2, 5, 7]}. For the model provide a dictionary of hyper parameters to grid search, not the dafualt models
in this library have a grid which can be used by default.</li>
</ol>
<pre><code>model.build_pipline_list(feature_scaling=&quot;passthrough&quot;)
cls.build_parameter_grid(
    feature_scaling_param_grid={&quot;feature_scaling&quot;: [MinMaxScaler(), StandardScaler()]},
    model_param_grid=my_model.default_param_grid
)
cls.make_pipeline()
</code></pre>
<ol>
<li>You can now eun the grid search, defining scoring functions to use. Note the first one is used to identify the best model and refit</li>
</ol>
<pre><code>gs = cls.optimize_model(scoring=(&quot;neg_root_mean_squared_error&quot;, &quot;r2&quot;))
</code></pre>
<p>Args:
    RXGridSearchSklearnRegresssor (<em>type</em>): <em>description</em></p></div>
  <div class="source_cont">
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.log" class="name">var <span class="ident">log</span></p>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.log">log</a></code>
    </p>



  <div class="source_cont">
</div>

            </div>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.Xtest" class="name">var <span class="ident">Xtest</span></p>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.Xtest">Xtest</a></code>
    </p>



    <div class="desc inherited"><p>Set the features for training</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.Xtrain" class="name">var <span class="ident">Xtrain</span></p>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.Xtrain">Xtrain</a></code>
    </p>



    <div class="desc inherited"><p>Set the features for training</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.model_name" class="name">var <span class="ident">model_name</span></p>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.model_name">model_name</a></code>
    </p>



    <div class="desc inherited"><p>Set the model name</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.ytest" class="name">var <span class="ident">ytest</span></p>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.ytest">ytest</a></code>
    </p>



    <div class="desc inherited"><p>Set the features for training</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.ytrain" class="name">var <span class="ident">ytrain</span></p>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.ytrain">ytrain</a></code>
    </p>



    <div class="desc inherited"><p>Set the target for training</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>

  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.build_parameter_grid">
    <p>def <span class="ident">build_parameter_grid</span>(</p><p>self, feature_scaling_param_grid: Optional[dict] = None, dimensionality_reduction_param_grid: Optional[dict] = None, feature_selection_param_grid: Optional[dict] = None, model_param_grid: Optional[dict] = None, add_prepends_for_pipe_to_all: bool = True)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_parameter_grid">build_parameter_grid</a></code>
    </p>



    <div class="desc inherited"><p>Function to build the parameter grid. It will by default prepend the pipeline step to the parameters as needed. Then it combines all input dictionaries, not there should not
be any overlapping keys in the separete input dictionaries</p>
<p>Args:
    feature_scaling_param_grid (Optional[dict], optional): dictionary of options for feature scaling (if any) in the model pipeline. Defaults to None.
    dimensionality_reduction_param_grid (Optional[dict], optional): dictionary of options for dimensionality reduction (if any) in the model pipeline. Defaults to None.
    feature_selection_param_grid (Optional[dict], optional): dictionary of options for feature selection (if any) in the model pipeline. Defaults to None.
    model_param_grid (Optional[dict], optional): dictionary of options for model hyper-parameters in the model pipeline. Defaults to None.
    add_prepends_for_pipe_to_all (bool, optional): Whether to add the pipeline element prepend lables to each key. Defaults to True.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.build_parameter_grid', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.build_parameter_grid" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_parameter_grid</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">feature_scaling_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dimensionality_reduction_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_selection_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">add_prepends_for_pipe_to_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to build the parameter grid. It will by default prepend the pipeline step to the parameters as needed. Then it combines all input dictionaries, not there should not</span>
<span class="sd">    be any overlapping keys in the separete input dictionaries</span>
<span class="sd">    Args:</span>
<span class="sd">        feature_scaling_param_grid (Optional[dict], optional): dictionary of options for feature scaling (if any) in the model pipeline. Defaults to None.</span>
<span class="sd">        dimensionality_reduction_param_grid (Optional[dict], optional): dictionary of options for dimensionality reduction (if any) in the model pipeline. Defaults to None.</span>
<span class="sd">        feature_selection_param_grid (Optional[dict], optional): dictionary of options for feature selection (if any) in the model pipeline. Defaults to None.</span>
<span class="sd">        model_param_grid (Optional[dict], optional): dictionary of options for model hyper-parameters in the model pipeline. Defaults to None.</span>
<span class="sd">        add_prepends_for_pipe_to_all (bool, optional): Whether to add the pipeline element prepend lables to each key. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">add_prepends_for_pipe_to_all</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_scaling_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">feature_scaling_param_grid</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                    <span class="n">feature_scaling_param_grid</span><span class="p">,</span> <span class="s2">&quot;feature_scaling&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dimensionality_reduction_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">dimensionality_reduction_param_grid</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                    <span class="n">dimensionality_reduction_param_grid</span><span class="p">,</span> <span class="s2">&quot;dimensionality_reduction&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_selection_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">feature_selection_param_grid</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                    <span class="n">feature_selection_param_grid</span><span class="p">,</span> <span class="s2">&quot;feature_selection&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">model_param_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                <span class="n">model_param_grid</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span>
            <span class="p">)</span>
    <span class="c1"># NOTE: it assumes there are no overlapping keys but doesn&#39;t check</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_scaling_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">feature_scaling_param_grid</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dimensionality_reduction_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">dimensionality_reduction_param_grid</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_selection_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">feature_selection_param_grid</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">model_param_grid</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.build_pipline_list">
    <p>def <span class="ident">build_pipline_list</span>(</p><p>self, pipeline_element_order=None, feature_scaling: Union[List[str], Callable, str, NoneType] = None, dimensionality_reduction: Union[List[str], Callable, str, NoneType] = None, feature_selection: Union[List[str], Callable, str, NoneType] = None)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_pipline_list">build_pipline_list</a></code>
    </p>



    <div class="desc inherited"><p>This function builds a list of sklearn pipeline elements. It is stored as list internally so that it can be modified. Once happy call
self.make_pipeline to set the pipeline in the class. Note you can pass a pipeline and param_grid in to the class directly to use.</p>
<p>Args:
    pipeline_element_order (<em>type</em>, optional): A dictionary of scikit learn pipeline steps with keys of "feature_scaling",
    "dimensionality_reduction", "feature_selection" and "model" and values of integers which set the order in which these steps will
    happen in the pipeline. Defaults to None.</p>
<p>Raises:
    ValueError: if an unknown step is trying to be added to the pipeline</p>
<p>Returns:
    List: list of tuples of steps for the pipeline</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.build_pipline_list', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.build_pipline_list" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_pipline_list</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">pipeline_element_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_scaling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dimensionality_reduction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_selection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function builds a list of sklearn pipeline elements. It is stored as list internally so that it can be modified. Once happy call</span>
<span class="sd">    self.make_pipeline to set the pipeline in the class. Note you can pass a pipeline and param_grid in to the class directly to use.</span>
<span class="sd">    Args:</span>
<span class="sd">        pipeline_element_order (_type_, optional): A dictionary of scikit learn pipeline steps with keys of &quot;feature_scaling&quot;,</span>
<span class="sd">        &quot;dimensionality_reduction&quot;, &quot;feature_selection&quot; and &quot;model&quot; and values of integers which set the order in which these steps will</span>
<span class="sd">        happen in the pipeline. Defaults to None.</span>
<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if an unknown step is trying to be added to the pipeline</span>
<span class="sd">    Returns:</span>
<span class="sd">        List: list of tuples of steps for the pipeline</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pipeline_element_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">orders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_pipe_order</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe_order</span> <span class="o">=</span> <span class="n">orders</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">orders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_pipe_order</span><span class="p">(</span><span class="o">**</span><span class="n">pipeline_element_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe_order</span> <span class="o">=</span> <span class="n">orders</span>
    <span class="k">if</span> <span class="n">feature_scaling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_scaling</span> <span class="o">=</span> <span class="n">feature_scaling</span>
    <span class="k">if</span> <span class="n">dimensionality_reduction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality_reduction</span> <span class="o">=</span> <span class="n">dimensionality_reduction</span>
    <span class="k">if</span> <span class="n">feature_selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_selection</span> <span class="o">=</span> <span class="n">feature_selection</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">elt</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline element: </span><span class="si">{</span><span class="n">elt</span><span class="si">}</span><span class="s2"> in order </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;feature_scaling&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_scaling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added feature scaling to pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_scaling</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;dimensionality_reduction&quot;</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality_reduction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added dimensionality reduction to pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality_reduction</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;feature_selection&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added feature selection to pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_selection</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;model&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added model to pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">ent</span> <span class="o">!=</span> <span class="n">elt</span>
            <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;feature_scaling&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dimensionality_reduction&quot;</span><span class="p">,</span>
                <span class="s2">&quot;feature_selection&quot;</span><span class="p">,</span>
                <span class="s2">&quot;model&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown pipeline entry requested </span><span class="si">{</span><span class="n">elt</span><span class="si">}</span><span class="s2">. This class can only accept feature_scaling, dimensionality_reduction, feature_selection, model.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No </span><span class="si">{</span><span class="n">elt</span><span class="si">}</span><span class="s2"> in the pipeline&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.build_train_test_validate_splits">
    <p>def <span class="ident">build_train_test_validate_splits</span>(</p><p>self, smiles_column: Optional[str] = None, task_columns: Optional[List[str]] = None, df: Optional[pandas.core.frame.DataFrame] = None, feature_columns: Optional[List[str]] = None, feature_column_regex: Optional[str] = None, splitter_type: Union[str, deepchem.splits.splitters.Splitter, NoneType] = None, train: Union[float, int, NoneType] = 0.8, test: Union[float, int, NoneType] = 0.1, holdout: Union[float, int, NoneType] = 0.1, kfold: Optional[int] = None, **kwargs)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_train_test_validate_splits">build_train_test_validate_splits</a></code>
    </p>



    <div class="desc inherited"><p>This is a function to build the data splits into train test and validate sets</p>
<p>Args:
    df (pd.DataFrame): All of the data in one dataframe to split into a dataset for ML/AI
    smiles_column (str): The column name that contains smiles strings
    task_columns (List[str]): List of y task column names
    feature_columns (Optional[List[str]], optional): Must provide this or feature_column_regex. If this is provided it is a list of the column names that correspond to features i.e. the X mat. Defaults to None.
    fesature_column_regex (Optional[str], optional): Must provide this or feature_columns. If this is provided it is a partial or full string to identify all columns that contain it as feature columns. Defaults to None.
    df (Optional[pd.DataFrame], optional): Dataframe to convert to a dataset and split. Please note the keyword args for this are passed through kwargs here, they correspond to the arguments for pandas_to_deepchem(). Defaults to None.
    train (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for training. Defaults to None.
    test (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for testing. Defaults to None.
    validation (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for validation. Defaults to None.
    _kfold (Optional[int], optional): The number of k fold splits. Defaults to None.</p>
<p>Raises:
    RunTimeError: data is not found in the class and is not passed to the call</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.build_train_test_validate_splits', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.build_train_test_validate_splits" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_train_test_validate_splits</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">smiles_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">task_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_column_regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">splitter_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">dc</span><span class="o">.</span><span class="n">splits</span><span class="o">.</span><span class="n">Splitter</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">train</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="n">test</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">holdout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">kfold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># TODO: set up for kfold</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a function to build the data splits into train test and validate sets</span>
<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): All of the data in one dataframe to split into a dataset for ML/AI</span>
<span class="sd">        smiles_column (str): The column name that contains smiles strings</span>
<span class="sd">        task_columns (List[str]): List of y task column names</span>
<span class="sd">        feature_columns (Optional[List[str]], optional): Must provide this or feature_column_regex. If this is provided it is a list of the column names that correspond to features i.e. the X mat. Defaults to None.</span>
<span class="sd">        fesature_column_regex (Optional[str], optional): Must provide this or feature_columns. If this is provided it is a partial or full string to identify all columns that contain it as feature columns. Defaults to None.</span>
<span class="sd">        df (Optional[pd.DataFrame], optional): Dataframe to convert to a dataset and split. Please note the keyword args for this are passed through kwargs here, they correspond to the arguments for pandas_to_deepchem(). Defaults to None.</span>
<span class="sd">        train (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for training. Defaults to None.</span>
<span class="sd">        test (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for testing. Defaults to None.</span>
<span class="sd">        validation (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for validation. Defaults to None.</span>
<span class="sd">        _kfold (Optional[int], optional): The number of k fold splits. Defaults to None.</span>
<span class="sd">    Raises:</span>
<span class="sd">        RunTimeError: data is not found in the class and is not passed to the call</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">tmp_dat</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">pandas_to_deepchem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span><span class="p">,</span>
            <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column</span><span class="p">,</span>
            <span class="n">task_columns</span><span class="o">=</span><span class="n">task_columns</span><span class="p">,</span>
            <span class="n">feature_columns</span><span class="o">=</span><span class="n">feature_columns</span><span class="p">,</span>
            <span class="n">feature_column_regex</span><span class="o">=</span><span class="n">feature_column_regex</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">tmp_dat</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">pandas_to_deepchem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span><span class="p">,</span>
            <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column</span><span class="p">,</span>
            <span class="n">task_columns</span><span class="o">=</span><span class="n">task_columns</span><span class="p">,</span>
            <span class="n">feature_columns</span><span class="o">=</span><span class="n">feature_columns</span><span class="p">,</span>
            <span class="n">feature_column_regex</span><span class="o">=</span><span class="n">feature_column_regex</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Data not found! Please set self.data_df or pass in a dataframe to this function.&quot;</span>
        <span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Training fraction </span><span class="si">{</span><span class="n">train</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="si">}</span><span class="s2"> Testing fraction </span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="si">}</span><span class="s2">validation fraction </span><span class="si">{</span><span class="n">holdout</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">holdout</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">holdout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kfold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">train</span><span class="p">,</span> <span class="n">holdout</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
            <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span>
            <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span>
            <span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">,</span>
            <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">,</span>
            <span class="n">holdout</span><span class="o">=</span><span class="n">holdout</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="n">holdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_validate</span> <span class="o">=</span> <span class="n">holdout</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_validate</span> <span class="o">=</span> <span class="n">holdout</span><span class="o">.</span><span class="n">y</span>
    <span class="k">elif</span> <span class="n">holdout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kfold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">splitter</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
            <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span>
            <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span>
            <span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">,</span>
            <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">,</span>
            <span class="n">holdout</span><span class="o">=</span><span class="n">holdout</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">y</span>
    <span class="k">elif</span> <span class="n">kfold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">holdout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2"> fold&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
                <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span> <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span> <span class="n">kfold</span><span class="o">=</span><span class="n">kfold</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2"> fold and validation holdout&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
                    <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span>
                    <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span>
                    <span class="n">holdout</span><span class="o">=</span><span class="n">holdout</span><span class="p">,</span>
                    <span class="n">kfold</span><span class="o">=</span><span class="n">kfold</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">y</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Using SciKit-Learn random splitter you may want to consider using molecule splitters is this is for molecular data.&quot;</span>
        <span class="p">)</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
            <span class="n">tmp_dat</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
            <span class="n">tmp_dat</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
            <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="n">helpers</span><span class="o">.</span><span class="n">random_seed</span><span class="p">,</span>
            <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span>
    <span class="k">if</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Train: </span><span class="si">{</span><span class="n">train</span><span class="si">}</span><span class="s2">, Validation: </span><span class="si">{</span><span class="n">holdout</span><span class="si">}</span><span class="s2">, Test </span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2">, kfolds: </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2">, splitter </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Train: </span><span class="si">{</span><span class="n">train</span><span class="si">}</span><span class="s2">, Validation: </span><span class="si">{</span><span class="n">holdout</span><span class="si">}</span><span class="s2">, Test </span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2">, kfolds: </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.load_pipeline_into_class">
    <p>def <span class="ident">load_pipeline_into_class</span>(</p><p>self, filename: str = &#39;model.joblib&#39;)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.load_pipeline_into_class">load_pipeline_into_class</a></code>
    </p>



    <div class="desc inherited"><p>Load a model pipeline into this class</p>
<p>Args:
    filename (str): joblib file to load the model pipeline from</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.load_pipeline_into_class', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.load_pipeline_into_class" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load_pipeline_into_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;model.joblib&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a model pipeline into this class</span>
<span class="sd">    Args:</span>
<span class="sd">        filename (str): joblib file to load the model pipeline from</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.make_pipeline">
    <p>def <span class="ident">make_pipeline</span>(</p><p>self, return_pipeline: bool = False)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.make_pipeline">make_pipeline</a></code>
    </p>



    <div class="desc inherited"><p>Function to build a pipeline if the pipeline elements have been defined</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.make_pipeline', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.make_pipeline" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">make_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_pipeline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to build a pipeline if the pipeline elements have been defined</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting the scikit learn pipeline using </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_pipeline</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Pipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.optimize_model">
    <p>def <span class="ident">optimize_model</span>(</p><p>self, grid_cv: int = 5, verbose: bool = True, scoring: Optional[dict[Union[str, Callable]]] = None, refit: Optional[str] = None, return_gs: bool = False, **kwargs)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.optimize_model">optimize_model</a></code>
    </p>



    <div class="desc"><p>Function to train a model pipeline using the setting defined</p>
<p>Args:
    grid_cv (int, optional): The number of corss validation folds used to establish the best hyper-parameters. Defaults to 5.
    verbose (bool, optional): To print verbose or not trianing information. Defaults to True.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.optimize_model', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.optimize_model" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">optimize_model</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">grid_cv</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">scoring</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">refit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_gs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to train a model pipeline using the setting defined</span>
<span class="sd">    Args:</span>
<span class="sd">        grid_cv (int, optional): The number of corss validation folds used to establish the best hyper-parameters. Defaults to 5.</span>
<span class="sd">        verbose (bool, optional): To print verbose or not trianing information. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;This method will fit k modles on the data avaliable (exluding holdout validation data). This is done over k folds i.e. one model is trained using the best hyper-parameters found for each fold. The returned model must be evaluated on unseen held out data.&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Will use the parameter grid: </span><span class="si">{</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Will run the following pipeline to optimize the hyper parmaeters&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using the trianing data to run a Grid search CV&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scoring</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scoring</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;neg_mean_squared_error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;neg_root_mean_squared_error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;neg_mean_absolute_percentage_error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;r2&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using default scoring: </span><span class="si">{</span><span class="n">scoring</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">refit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">refit</span> <span class="o">=</span> <span class="n">scoring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">model_ensemble</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">completed_grid_search</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">best_parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ith</span><span class="p">,</span> <span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ith</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">train</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">test</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_pipeline</span><span class="p">(</span><span class="n">return_pipeline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
            <span class="n">pl</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span>
            <span class="n">cv</span><span class="o">=</span><span class="n">grid_cv</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span>
            <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_grid_search</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid_search</span><span class="p">)</span>
        <span class="n">model_ensemble</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;model_</span><span class="si">{</span><span class="n">ith</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">return_gs</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">model_ensemble</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">VotingRegressor</span><span class="p">(</span><span class="n">model_ensemble</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">expected_n_data</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">])</span>
        <span class="n">X_all_kf_data_concatenated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">])</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All X concatenate: </span><span class="si">{</span><span class="n">X_all_kf_data_concatenated</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">y_all_kf_data_concatenated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">])</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All y concatenate: </span><span class="si">{</span><span class="n">y_all_kf_data_concatenated</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                <span class="n">ent</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_n_data</span>
                <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span><span class="n">X_all_kf_data_concatenated</span><span class="p">,</span> <span class="n">y_all_kf_data_concatenated</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">aerr</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">aerr</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;ERROR - concatenating all kfold data for final fit leads to unequal number of dat points: expected: </span><span class="si">{</span><span class="n">expected_n_data</span><span class="si">}</span><span class="s2"> X data </span><span class="si">{</span><span class="n">X_all_kf_data_concatenated</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> y data </span><span class="si">{</span><span class="n">y_all_kf_data_concatenated</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_all_kf_data_concatenated</span><span class="p">,</span> <span class="n">y_all_kf_data_concatenated</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_all_kf_data_concatenated</span><span class="p">,</span> <span class="n">y_all_kf_data_concatenated</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">m</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">grid_search</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.save_model">
    <p>def <span class="ident">save_model</span>(</p><p>self, filename: str = &#39;model.joblib&#39;)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.save_model">save_model</a></code>
    </p>



    <div class="desc inherited"><p>Save the final model pipeline to a jobloib file</p>
<p>Args:
    filename (str): filename to save</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.save_model', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.save_model" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;model.joblib&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the final model pipeline to a jobloib file</span>
<span class="sd">    Args:</span>
<span class="sd">        filename (str): filename to save</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.save_self">
    <p>def <span class="ident">save_self</span>(</p><p>self, filename: str)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.save_self">save_self</a></code>
    </p>



    <div class="desc inherited"><p>Save the entire class as a pickle file</p>
<p>Args:
    filename (str): file name</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.save_self', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXKFoldGridSearchSklearnRegresssor.save_self" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">save_self</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the entire class as a pickle file</span>
<span class="sd">    Args:</span>
<span class="sd">        filename (str): file name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
        <span class="n">pkl</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>

      </div>
      </div>

      <div class="item">
      <p id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor" class="name">class <span class="ident">RXTrainTestGridSearchSklearnRegresssor</span></p>


    <div class="desc"><p>Class for building a model using a single train test split. This class encapulates a generalized model building process.
To fully optimze a model it will need to be taken put of this class. This is a method wrapper to enable several methods to be tested initially.</p>
<p>It is expected that this class is used in the following manner:
1. Load you data and featurize from your moleucle representation:</p>
<pre><code>df = pd.read_csv(&quot;my_data.csv)
feat_df = featurization.get_count_ecfp(data_df=df, smiles_column=&quot;smiles&quot;, return_df=True)
</code></pre>
<ol>
<li>Select your scikit learn model and parameter grid. You can use the default models provided in this libray which provides name, model and parameter grid to search as follows:</li>
</ol>
<pre><code>my_model = classical_ml_models.linear_models(lasso=False, lars=False)[0]
</code></pre>
<p>Alternatively wrap up your chosen model:</p>
<pre><code>from chemutil.classical_ml_models import skmodel

my_model = skmodel(
    type(RandomForestRegressor()).__name__,
    RandomForestRegressor(random_state=helpers.random_seed, n_jobs=-1),
    {
        &quot;n_estimators&quot;: [50, 100, 200],
        &quot;min_samples_split&quot;: [2, 4],
        &quot;ccp_alpha&quot;: [0.0, 0.05],
        &quot;max_features&quot;: [&quot;sqrt&quot;, &quot;log2&quot;, 1.0],
    },
    {},
    True,
    &quot;https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html&quot;,
    sklearn.__version__,
    datetime.now(),
)
</code></pre>
<ol>
<li>Instantiate this class and load the model and data into the class</li>
</ol>
<pre><code>cls = RXGridSearchSklearnRegresssor(
    feat_df,
    model=linear_regression_models.model,
    model_name=linear_regression_models.name
)
</code></pre>
<ol>
<li>Set your data splits this example is based on train test splits and uses tye molecular weight splitter from deepchem</li>
</ol>
<pre><code>cls.build_trian_test_validate_splits(
    smiles_column=&quot;smiles&quot;,
    task_columns=[&quot;taskX&quot;],
    feature_column_regex=&quot;ecfp_count_bit_&quot;,
    splitter_type=&quot;mw&quot;,
    train=0.8,
    test=0.2,
    validation=None
)
</code></pre>
<ol>
<li>Define your sklearn pipeline to include, in addition to the model, any of the following elements feature_scaling, dimensionality_reduction or feature_selection. provide the word "passthrough" to activate this
element or if you are fixing to just one method you can add that directly i.e. feature_scaling=MinMaxScaler(). Following this define the parameter grid to search. if you have activated any of the optional pipeline
elements if you have activated an element with "passthrough" you must provide a key of the element mapping to the method eg {"feature_scaling": MinMaxScaler()}. You can then extend the dictionary with
hyper-parameters to try i.e. "dimensionality_reduction": PCA(), "n_components": [2, 3, 4], "iterated_power": [2, 5, 7]}. For the model provide a dictionary of hyper parameters to grid search, not the dafualt models
in this library have a grid which can be used by default.</li>
</ol>
<pre><code>model.build_pipline_list(feature_scaling=&quot;passthrough&quot;)
cls.build_parameter_grid(
    feature_scaling_param_grid={&quot;feature_scaling&quot;: [MinMaxScaler(), StandardScaler()]},
    model_param_grid=my_model.default_param_grid
)
cls.make_pipeline()
</code></pre>
<ol>
<li>You can now eun the grid search, defining scoring functions to use. Note the first one is used to identify the best model and refit</li>
</ol>
<pre><code>gs = cls.optimize_model(scoring=(&quot;neg_root_mean_squared_error&quot;, &quot;r2&quot;))
</code></pre>
<p>Args:
    RXGridSearchSklearnRegresssor (<em>type</em>): <em>description</em></p></div>
  <div class="source_cont">
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.log" class="name">var <span class="ident">log</span></p>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.log">log</a></code>
    </p>



  <div class="source_cont">
</div>

            </div>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.Xtest" class="name">var <span class="ident">Xtest</span></p>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.Xtest">Xtest</a></code>
    </p>



    <div class="desc inherited"><p>Set the features for training</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.Xtrain" class="name">var <span class="ident">Xtrain</span></p>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.Xtrain">Xtrain</a></code>
    </p>



    <div class="desc inherited"><p>Set the features for training</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.model_name" class="name">var <span class="ident">model_name</span></p>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.model_name">model_name</a></code>
    </p>



    <div class="desc inherited"><p>Set the model name</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.ytest" class="name">var <span class="ident">ytest</span></p>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.ytest">ytest</a></code>
    </p>



    <div class="desc inherited"><p>Set the features for training</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.ytrain" class="name">var <span class="ident">ytrain</span></p>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.ytrain">ytrain</a></code>
    </p>



    <div class="desc inherited"><p>Set the target for training</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>

  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.build_parameter_grid">
    <p>def <span class="ident">build_parameter_grid</span>(</p><p>self, feature_scaling_param_grid: Optional[dict] = None, dimensionality_reduction_param_grid: Optional[dict] = None, feature_selection_param_grid: Optional[dict] = None, model_param_grid: Optional[dict] = None, add_prepends_for_pipe_to_all: bool = True)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_parameter_grid">build_parameter_grid</a></code>
    </p>



    <div class="desc inherited"><p>Function to build the parameter grid. It will by default prepend the pipeline step to the parameters as needed. Then it combines all input dictionaries, not there should not
be any overlapping keys in the separete input dictionaries</p>
<p>Args:
    feature_scaling_param_grid (Optional[dict], optional): dictionary of options for feature scaling (if any) in the model pipeline. Defaults to None.
    dimensionality_reduction_param_grid (Optional[dict], optional): dictionary of options for dimensionality reduction (if any) in the model pipeline. Defaults to None.
    feature_selection_param_grid (Optional[dict], optional): dictionary of options for feature selection (if any) in the model pipeline. Defaults to None.
    model_param_grid (Optional[dict], optional): dictionary of options for model hyper-parameters in the model pipeline. Defaults to None.
    add_prepends_for_pipe_to_all (bool, optional): Whether to add the pipeline element prepend lables to each key. Defaults to True.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.build_parameter_grid', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.build_parameter_grid" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_parameter_grid</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">feature_scaling_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dimensionality_reduction_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_selection_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model_param_grid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">add_prepends_for_pipe_to_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to build the parameter grid. It will by default prepend the pipeline step to the parameters as needed. Then it combines all input dictionaries, not there should not</span>
<span class="sd">    be any overlapping keys in the separete input dictionaries</span>
<span class="sd">    Args:</span>
<span class="sd">        feature_scaling_param_grid (Optional[dict], optional): dictionary of options for feature scaling (if any) in the model pipeline. Defaults to None.</span>
<span class="sd">        dimensionality_reduction_param_grid (Optional[dict], optional): dictionary of options for dimensionality reduction (if any) in the model pipeline. Defaults to None.</span>
<span class="sd">        feature_selection_param_grid (Optional[dict], optional): dictionary of options for feature selection (if any) in the model pipeline. Defaults to None.</span>
<span class="sd">        model_param_grid (Optional[dict], optional): dictionary of options for model hyper-parameters in the model pipeline. Defaults to None.</span>
<span class="sd">        add_prepends_for_pipe_to_all (bool, optional): Whether to add the pipeline element prepend lables to each key. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">add_prepends_for_pipe_to_all</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_scaling_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">feature_scaling_param_grid</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                    <span class="n">feature_scaling_param_grid</span><span class="p">,</span> <span class="s2">&quot;feature_scaling&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dimensionality_reduction_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">dimensionality_reduction_param_grid</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                    <span class="n">dimensionality_reduction_param_grid</span><span class="p">,</span> <span class="s2">&quot;dimensionality_reduction&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_selection_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">feature_selection_param_grid</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                    <span class="n">feature_selection_param_grid</span><span class="p">,</span> <span class="s2">&quot;feature_selection&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">model_param_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_dictionary_keys_for_sklearn_pipeline</span><span class="p">(</span>
                <span class="n">model_param_grid</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span>
            <span class="p">)</span>
    <span class="c1"># NOTE: it assumes there are no overlapping keys but doesn&#39;t check</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_scaling_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">feature_scaling_param_grid</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dimensionality_reduction_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">dimensionality_reduction_param_grid</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_selection_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">feature_selection_param_grid</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">model_param_grid</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.build_pipline_list">
    <p>def <span class="ident">build_pipline_list</span>(</p><p>self, pipeline_element_order=None, feature_scaling: Union[List[str], Callable, str, NoneType] = None, dimensionality_reduction: Union[List[str], Callable, str, NoneType] = None, feature_selection: Union[List[str], Callable, str, NoneType] = None)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_pipline_list">build_pipline_list</a></code>
    </p>



    <div class="desc inherited"><p>This function builds a list of sklearn pipeline elements. It is stored as list internally so that it can be modified. Once happy call
self.make_pipeline to set the pipeline in the class. Note you can pass a pipeline and param_grid in to the class directly to use.</p>
<p>Args:
    pipeline_element_order (<em>type</em>, optional): A dictionary of scikit learn pipeline steps with keys of "feature_scaling",
    "dimensionality_reduction", "feature_selection" and "model" and values of integers which set the order in which these steps will
    happen in the pipeline. Defaults to None.</p>
<p>Raises:
    ValueError: if an unknown step is trying to be added to the pipeline</p>
<p>Returns:
    List: list of tuples of steps for the pipeline</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.build_pipline_list', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.build_pipline_list" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_pipline_list</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">pipeline_element_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_scaling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dimensionality_reduction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_selection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function builds a list of sklearn pipeline elements. It is stored as list internally so that it can be modified. Once happy call</span>
<span class="sd">    self.make_pipeline to set the pipeline in the class. Note you can pass a pipeline and param_grid in to the class directly to use.</span>
<span class="sd">    Args:</span>
<span class="sd">        pipeline_element_order (_type_, optional): A dictionary of scikit learn pipeline steps with keys of &quot;feature_scaling&quot;,</span>
<span class="sd">        &quot;dimensionality_reduction&quot;, &quot;feature_selection&quot; and &quot;model&quot; and values of integers which set the order in which these steps will</span>
<span class="sd">        happen in the pipeline. Defaults to None.</span>
<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if an unknown step is trying to be added to the pipeline</span>
<span class="sd">    Returns:</span>
<span class="sd">        List: list of tuples of steps for the pipeline</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pipeline_element_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">orders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_pipe_order</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe_order</span> <span class="o">=</span> <span class="n">orders</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">orders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_pipe_order</span><span class="p">(</span><span class="o">**</span><span class="n">pipeline_element_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe_order</span> <span class="o">=</span> <span class="n">orders</span>
    <span class="k">if</span> <span class="n">feature_scaling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_scaling</span> <span class="o">=</span> <span class="n">feature_scaling</span>
    <span class="k">if</span> <span class="n">dimensionality_reduction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality_reduction</span> <span class="o">=</span> <span class="n">dimensionality_reduction</span>
    <span class="k">if</span> <span class="n">feature_selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_selection</span> <span class="o">=</span> <span class="n">feature_selection</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">elt</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline element: </span><span class="si">{</span><span class="n">elt</span><span class="si">}</span><span class="s2"> in order </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;feature_scaling&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_scaling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added feature scaling to pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_scaling</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;dimensionality_reduction&quot;</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality_reduction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added dimensionality reduction to pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality_reduction</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;feature_selection&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added feature selection to pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_selection</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;model&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Added model to pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">ent</span> <span class="o">!=</span> <span class="n">elt</span>
            <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;feature_scaling&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dimensionality_reduction&quot;</span><span class="p">,</span>
                <span class="s2">&quot;feature_selection&quot;</span><span class="p">,</span>
                <span class="s2">&quot;model&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown pipeline entry requested </span><span class="si">{</span><span class="n">elt</span><span class="si">}</span><span class="s2">. This class can only accept feature_scaling, dimensionality_reduction, feature_selection, model.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No </span><span class="si">{</span><span class="n">elt</span><span class="si">}</span><span class="s2"> in the pipeline&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.build_train_test_validate_splits">
    <p>def <span class="ident">build_train_test_validate_splits</span>(</p><p>self, smiles_column: Optional[str] = None, task_columns: Optional[List[str]] = None, df: Optional[pandas.core.frame.DataFrame] = None, feature_columns: Optional[List[str]] = None, feature_column_regex: Optional[str] = None, splitter_type: Union[str, deepchem.splits.splitters.Splitter, NoneType] = None, train: Union[float, int, NoneType] = 0.8, test: Union[float, int, NoneType] = 0.1, holdout: Union[float, int, NoneType] = 0.1, kfold: Optional[int] = None, **kwargs)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.build_train_test_validate_splits">build_train_test_validate_splits</a></code>
    </p>



    <div class="desc inherited"><p>This is a function to build the data splits into train test and validate sets</p>
<p>Args:
    df (pd.DataFrame): All of the data in one dataframe to split into a dataset for ML/AI
    smiles_column (str): The column name that contains smiles strings
    task_columns (List[str]): List of y task column names
    feature_columns (Optional[List[str]], optional): Must provide this or feature_column_regex. If this is provided it is a list of the column names that correspond to features i.e. the X mat. Defaults to None.
    fesature_column_regex (Optional[str], optional): Must provide this or feature_columns. If this is provided it is a partial or full string to identify all columns that contain it as feature columns. Defaults to None.
    df (Optional[pd.DataFrame], optional): Dataframe to convert to a dataset and split. Please note the keyword args for this are passed through kwargs here, they correspond to the arguments for pandas_to_deepchem(). Defaults to None.
    train (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for training. Defaults to None.
    test (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for testing. Defaults to None.
    validation (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for validation. Defaults to None.
    _kfold (Optional[int], optional): The number of k fold splits. Defaults to None.</p>
<p>Raises:
    RunTimeError: data is not found in the class and is not passed to the call</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.build_train_test_validate_splits', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.build_train_test_validate_splits" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_train_test_validate_splits</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">smiles_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">task_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_column_regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">splitter_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">dc</span><span class="o">.</span><span class="n">splits</span><span class="o">.</span><span class="n">Splitter</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">train</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="n">test</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">holdout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">kfold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># TODO: set up for kfold</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a function to build the data splits into train test and validate sets</span>
<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): All of the data in one dataframe to split into a dataset for ML/AI</span>
<span class="sd">        smiles_column (str): The column name that contains smiles strings</span>
<span class="sd">        task_columns (List[str]): List of y task column names</span>
<span class="sd">        feature_columns (Optional[List[str]], optional): Must provide this or feature_column_regex. If this is provided it is a list of the column names that correspond to features i.e. the X mat. Defaults to None.</span>
<span class="sd">        fesature_column_regex (Optional[str], optional): Must provide this or feature_columns. If this is provided it is a partial or full string to identify all columns that contain it as feature columns. Defaults to None.</span>
<span class="sd">        df (Optional[pd.DataFrame], optional): Dataframe to convert to a dataset and split. Please note the keyword args for this are passed through kwargs here, they correspond to the arguments for pandas_to_deepchem(). Defaults to None.</span>
<span class="sd">        train (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for training. Defaults to None.</span>
<span class="sd">        test (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for testing. Defaults to None.</span>
<span class="sd">        validation (Optional[Union[float, int]], optional): the number or fraction (as a decimal) of the data to use for validation. Defaults to None.</span>
<span class="sd">        _kfold (Optional[int], optional): The number of k fold splits. Defaults to None.</span>
<span class="sd">    Raises:</span>
<span class="sd">        RunTimeError: data is not found in the class and is not passed to the call</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">tmp_dat</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">pandas_to_deepchem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span><span class="p">,</span>
            <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column</span><span class="p">,</span>
            <span class="n">task_columns</span><span class="o">=</span><span class="n">task_columns</span><span class="p">,</span>
            <span class="n">feature_columns</span><span class="o">=</span><span class="n">feature_columns</span><span class="p">,</span>
            <span class="n">feature_column_regex</span><span class="o">=</span><span class="n">feature_column_regex</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">tmp_dat</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">pandas_to_deepchem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span><span class="p">,</span>
            <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column</span><span class="p">,</span>
            <span class="n">task_columns</span><span class="o">=</span><span class="n">task_columns</span><span class="p">,</span>
            <span class="n">feature_columns</span><span class="o">=</span><span class="n">feature_columns</span><span class="p">,</span>
            <span class="n">feature_column_regex</span><span class="o">=</span><span class="n">feature_column_regex</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Data not found! Please set self.data_df or pass in a dataframe to this function.&quot;</span>
        <span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Training fraction </span><span class="si">{</span><span class="n">train</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="si">}</span><span class="s2"> Testing fraction </span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="si">}</span><span class="s2">validation fraction </span><span class="si">{</span><span class="n">holdout</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">holdout</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">holdout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kfold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">train</span><span class="p">,</span> <span class="n">holdout</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
            <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span>
            <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span>
            <span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">,</span>
            <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">,</span>
            <span class="n">holdout</span><span class="o">=</span><span class="n">holdout</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="n">holdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_validate</span> <span class="o">=</span> <span class="n">holdout</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_validate</span> <span class="o">=</span> <span class="n">holdout</span><span class="o">.</span><span class="n">y</span>
    <span class="k">elif</span> <span class="n">holdout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kfold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">splitter</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
            <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span>
            <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span>
            <span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">,</span>
            <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">,</span>
            <span class="n">holdout</span><span class="o">=</span><span class="n">holdout</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">y</span>
    <span class="k">elif</span> <span class="n">kfold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">holdout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2"> fold&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
                <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span> <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span> <span class="n">kfold</span><span class="o">=</span><span class="n">kfold</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2"> fold and validation holdout&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kfolds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">datasets</span><span class="o">.</span><span class="n">molecular_dataset_split</span><span class="p">(</span>
                    <span class="n">ds</span><span class="o">=</span><span class="n">tmp_dat</span><span class="p">,</span>
                    <span class="n">splitter_type</span><span class="o">=</span><span class="n">splitter_type</span><span class="p">,</span>
                    <span class="n">holdout</span><span class="o">=</span><span class="n">holdout</span><span class="p">,</span>
                    <span class="n">kfold</span><span class="o">=</span><span class="n">kfold</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">y</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Using SciKit-Learn random splitter you may want to consider using molecule splitters is this is for molecular data.&quot;</span>
        <span class="p">)</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
            <span class="n">tmp_dat</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
            <span class="n">tmp_dat</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
            <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="n">helpers</span><span class="o">.</span><span class="n">random_seed</span><span class="p">,</span>
            <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span>
    <span class="k">if</span> <span class="n">splitter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Train: </span><span class="si">{</span><span class="n">train</span><span class="si">}</span><span class="s2">, Validation: </span><span class="si">{</span><span class="n">holdout</span><span class="si">}</span><span class="s2">, Test </span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2">, kfolds: </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2">, splitter </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Train: </span><span class="si">{</span><span class="n">train</span><span class="si">}</span><span class="s2">, Validation: </span><span class="si">{</span><span class="n">holdout</span><span class="si">}</span><span class="s2">, Test </span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2">, kfolds: </span><span class="si">{</span><span class="n">kfold</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.load_pipeline_into_class">
    <p>def <span class="ident">load_pipeline_into_class</span>(</p><p>self, filename: str = &#39;model.joblib&#39;)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.load_pipeline_into_class">load_pipeline_into_class</a></code>
    </p>



    <div class="desc inherited"><p>Load a model pipeline into this class</p>
<p>Args:
    filename (str): joblib file to load the model pipeline from</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.load_pipeline_into_class', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.load_pipeline_into_class" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load_pipeline_into_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;model.joblib&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a model pipeline into this class</span>
<span class="sd">    Args:</span>
<span class="sd">        filename (str): joblib file to load the model pipeline from</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.make_pipeline">
    <p>def <span class="ident">make_pipeline</span>(</p><p>self, return_pipeline: bool = False)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.make_pipeline">make_pipeline</a></code>
    </p>



    <div class="desc inherited"><p>Function to build a pipeline if the pipeline elements have been defined</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.make_pipeline', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.make_pipeline" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">make_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_pipeline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to build a pipeline if the pipeline elements have been defined</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting the scikit learn pipeline using </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_pipeline</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Pipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elts</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.optimize_model">
    <p>def <span class="ident">optimize_model</span>(</p><p>self, cv: int = 5, verbose: int = 2, scoring: Optional[dict[Union[str, Callable]]] = None, refit: Optional[str] = None, return_model: bool = False, **kwargs)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.optimize_model">optimize_model</a></code>
    </p>



    <div class="desc inherited"><p>Function to train a model pipeline using the setting defined</p>
<p>Args:
    cv (int, optional): The number of corss validation folds used to establish the best hyper-parameters. Defaults to 5.
    verbose (bool, optional): To print verbose or not trianing information. Defaults to True.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.optimize_model', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.optimize_model" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">optimize_model</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">cv</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">scoring</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">refit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to train a model pipeline using the setting defined</span>
<span class="sd">    Args:</span>
<span class="sd">        cv (int, optional): The number of corss validation folds used to establish the best hyper-parameters. Defaults to 5.</span>
<span class="sd">        verbose (bool, optional): To print verbose or not trianing information. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Will use the parameter grid: </span><span class="si">{</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Will run the following pipeline to optimize the hyper parmaeters&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using the trianing data to run a Grid search CV&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scoring</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scoring</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;neg_mean_squared_error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;neg_root_mean_squared_error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;neg_mean_absolute_percentage_error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;r2&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using default scoring: </span><span class="si">{</span><span class="n">scoring</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">refit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">refit</span> <span class="o">=</span> <span class="n">scoring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span>
        <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">completed_grid_search</span> <span class="o">=</span> <span class="n">grid_search</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">best_parmeters</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>
    <span class="k">if</span> <span class="n">return_model</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">grid_search</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.save_model">
    <p>def <span class="ident">save_model</span>(</p><p>self, filename: str = &#39;model.joblib&#39;)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.save_model">save_model</a></code>
    </p>



    <div class="desc inherited"><p>Save the final model pipeline to a jobloib file</p>
<p>Args:
    filename (str): filename to save</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.save_model', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.save_model" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;model.joblib&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the final model pipeline to a jobloib file</span>
<span class="sd">    Args:</span>
<span class="sd">        filename (str): filename to save</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.save_self">
    <p>def <span class="ident">save_self</span>(</p><p>self, filename: str)</p>
    </div>

    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor">RXGridSearchSklearnRegresssor</a></code>.<code><a href="#chemutil.classical_ml_model_build.RXGridSearchSklearnRegresssor.save_self">save_self</a></code>
    </p>



    <div class="desc inherited"><p>Save the entire class as a pickle file</p>
<p>Args:
    filename (str): file name</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.save_self', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.classical_ml_model_build.RXTrainTestGridSearchSklearnRegresssor.save_self" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">save_self</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the entire class as a pickle file</span>
<span class="sd">    Args:</span>
<span class="sd">        filename (str): file name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
        <span class="n">pkl</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>

      </div>
      </div>

  </section>
</article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Generated by <a href="https://github.com/timothycrosley/pdocs">pdocs 1.2.0</a>
    </p>
  </footer>
</div>
</body>
</html>
