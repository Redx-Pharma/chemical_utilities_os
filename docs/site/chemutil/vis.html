<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />


  <title>chemutil.vis API documentation</title>
  <meta name="description" content="Module for providing generally useful visulaization functions" />


  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>

  <style type="text/css">
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}
</style>
  <style type="text/css">
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  }

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; }

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;

      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/
</style>
  <style type="text/css">
  pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #3D7B7B; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #F00 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666 } /* Operator */
.codehilite .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #9C6500 } /* Comment.Preproc */
.codehilite .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.codehilite .gr { color: #E40000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #008400 } /* Generic.Inserted */
.codehilite .go { color: #717171 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #04D } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #687822 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #00F; font-weight: bold } /* Name.Class */
.codehilite .no { color: #800 } /* Name.Constant */
.codehilite .nd { color: #A2F } /* Name.Decorator */
.codehilite .ni { color: #717171; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #00F } /* Name.Function */
.codehilite .nl { color: #767600 } /* Name.Label */
.codehilite .nn { color: #00F; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #A2F; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #BBB } /* Text.Whitespace */
.codehilite .mb { color: #666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666 } /* Literal.Number.Float */
.codehilite .mh { color: #666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #A45A77 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #00F } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666 } /* Literal.Number.Integer.Long */
  </style>
  <style type="text/css">
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}
</style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>
<div id="container">




















  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3>Super-module</h3>
      <ul>
        <li class="mono"><a href="index.html">chemutil</a></li>
      </ul>
    </li>
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>

  <ul>
    <li class="mono"><a href="#chemutil.vis.log">log</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>

  <ul>
    <li class="mono"><a href="#chemutil.vis.draw_aligned_mol_grid">draw_aligned_mol_grid</a></li>
    <li class="mono"><a href="#chemutil.vis.draw_molecule_to_file">draw_molecule_to_file</a></li>
    <li class="mono"><a href="#chemutil.vis.get_tanimoto_intra_dataset_matrix">get_tanimoto_intra_dataset_matrix</a></li>
    <li class="mono"><a href="#chemutil.vis.get_tanimoto_matrix">get_tanimoto_matrix</a></li>
    <li class="mono"><a href="#chemutil.vis.list_of_png_files_to_single_pdf">list_of_png_files_to_single_pdf</a></li>
    <li class="mono"><a href="#chemutil.vis.molecule_similarity_maps">molecule_similarity_maps</a></li>
    <li class="mono"><a href="#chemutil.vis.seaborn_correlation_heat_map">seaborn_correlation_heat_map</a></li>
    <li class="mono"><a href="#chemutil.vis.seaborn_pair_plot">seaborn_pair_plot</a></li>
    <li class="mono"><a href="#chemutil.vis.tanimoto_box_plot">tanimoto_box_plot</a></li>
    <li class="mono"><a href="#chemutil.vis.tanimoto_distrbution_plots">tanimoto_distrbution_plots</a></li>
    <li class="mono"><a href="#chemutil.vis.tanimoto_distrbution_plots_intra_dataset">tanimoto_distrbution_plots_intra_dataset</a></li>
    <li class="mono"><a href="#chemutil.vis.tanimoto_intra_dataset_box_plot">tanimoto_intra_dataset_box_plot</a></li>
  </ul>

    </li>


    </ul>
  </div>

<article id="content">





  <header id="section-intro">
  <h1 class="title"><span class="name">chemutil.vis</span> module</h1>
  <p>Module for providing generally useful visulaization functions</p>

  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.vis', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.vis" class="source">
    <div class="codehilite"><pre><span></span><span class="ch">#!/usr/bin.env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for providing generally useful visulaization functions</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL.PngImagePlugin</span><span class="w"> </span><span class="kn">import</span> <span class="n">PngImageFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rdkit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Chem</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rdkit.Chem</span><span class="w"> </span><span class="kn">import</span> <span class="n">Draw</span><span class="p">,</span> <span class="n">AllChem</span><span class="p">,</span> <span class="n">rdFMCS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rdkit</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataStructs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rdkit.Chem.Draw</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimilarityMaps</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rdkit.Chem.rdMolDescriptors</span><span class="w"> </span><span class="kn">import</span> <span class="n">CalcMolFormula</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.axes</span><span class="w"> </span><span class="kn">import</span> <span class="n">Axes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chemutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">featurization</span><span class="p">,</span> <span class="n">smilesmod</span><span class="p">,</span> <span class="n">inchimod</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">textwrap</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw_molecule_to_file</span><span class="p">(</span>
    <span class="n">mol</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">Mol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">smiles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">inchi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mcs_smarts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">image_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PngImageFile</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw a molecule image and write to file if requested. Return the raw image object.</span>

<span class="sd">    Args:</span>
<span class="sd">        mols (Optional[List[rdkit.rdMol.Mol]], optional): List of RDKit molecule objects. Defaults to None.</span>
<span class="sd">        smiles (Optional[List[str]], optional): List of smiles strings. Defaults to None.</span>
<span class="sd">        inchi (Optional[List[str]], optional): List of InChi strings. Defaults to None.</span>
<span class="sd">        mcs_smarts (Optional[List[str]], optional): Pre computed maximum common substructure smarts string. Defaults to None.</span>
<span class="sd">        labels (Optional[List[str]], optional): List of string labels for the molecules. Defaults to None.</span>
<span class="sd">        sub_image_size (Tuple[int, int], optional): the size in pixels of each molecule image. Defaults to (400, 400).</span>
<span class="sd">        filename (Optional[str], optional): What to save the image as if None it is not saved. Defaults to None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        UserWarning: If None of the molecules formats are provided by the use</span>

<span class="sd">    Returns:</span>
<span class="sd">        PIL.PngImagePlugin.PngImageFile: Raw image object (.save(file) to save the image)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check the user has input one of the required inputs</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">ent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mol</span><span class="p">,</span> <span class="n">smiles</span><span class="p">,</span> <span class="n">inchi</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="s2">&quot;One of mols, smiles or inchi must be given for input&quot;</span><span class="p">)</span>

    <span class="c1"># Make sure there is a list of molecules</span>
    <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># smiles is the lowest priority</span>
        <span class="k">if</span> <span class="n">inchi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">inchimod</span><span class="o">.</span><span class="n">inchi_to_molecule</span><span class="p">(</span><span class="n">inchi</span><span class="o">=</span><span class="n">inchi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">smiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">smilesmod</span><span class="o">.</span><span class="n">smiles_to_molecule</span><span class="p">(</span><span class="n">smi</span><span class="o">=</span><span class="n">smiles</span><span class="p">)</span>

    <span class="c1"># one moleucle image code aligned to the mcs smarts from a user or not when not avaliable</span>
    <span class="k">if</span> <span class="n">mcs_smarts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolToImage</span><span class="p">(</span>
            <span class="n">mol</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span> <span class="n">kekulize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wedgeBonds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legends</span><span class="o">=</span><span class="n">labels</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mcs_mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">mcs_smarts</span><span class="p">)</span>
        <span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">mcs_mol</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GenerateDepictionMatching2DStructure</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mcs_mol</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolToImage</span><span class="p">(</span>
            <span class="n">mol</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span> <span class="n">kekulize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wedgeBonds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legends</span><span class="o">=</span><span class="n">labels</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">img</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw_aligned_mol_grid</span><span class="p">(</span>
    <span class="n">mols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">Mol</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">smiles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">inchi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mcs_smarts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mols_per_row</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">sub_image_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_mols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">legend_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">highlight_mcs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PngImageFile</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw a grid of molecule images and write to file if requested. Return the raw image object.</span>

<span class="sd">    Args:</span>
<span class="sd">        mols (Optional[List[rdkit.rdMol.Mol]], optional): List of RDKit molecule objects. Defaults to None.</span>
<span class="sd">        smiles (Optional[List[str]], optional): List of smiles strings. Defaults to None.</span>
<span class="sd">        inchi (Optional[List[str]], optional): List of InChi strings. Defaults to None.</span>
<span class="sd">        mcs_smarts (Optional[List[str]], optional): Pre computed maximum common substructure smarts string. Defaults to None.</span>
<span class="sd">        labels (Optional[List[str]], optional): List of string labels for the molecules. Defaults to None.</span>
<span class="sd">        mols_per_row (int, optional): number of molecules to show in each row. Defaults to 5.</span>
<span class="sd">        sub_image_size (Tuple[int, int], optional): the size in pixels of each molecule image. Defaults to (400, 400).</span>
<span class="sd">        filename (Optional[str], optional): What to save the image as if None it is not saved. Defaults to None.</span>
<span class="sd">        max_mols (Optional[int], optional): The max mols to show in a grid plot None plot all. Defaults to None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        UserWarning: If None of the molecules formats are provided by the use</span>

<span class="sd">    Returns:</span>
<span class="sd">        PIL.PngImagePlugin.PngImageFile: Raw image object (.save(file) to save the image)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check the user has input one of the required inputs</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">ent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mols</span><span class="p">,</span> <span class="n">smiles</span><span class="p">,</span> <span class="n">inchi</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="s2">&quot;One of mols, smiles or inchi must be given for input&quot;</span><span class="p">)</span>

    <span class="c1"># Make sure there is a list of molecules</span>
    <span class="k">if</span> <span class="n">mols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># smiles is the lowest priority</span>
        <span class="k">if</span> <span class="n">inchi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">inchimod</span><span class="o">.</span><span class="n">inchi_to_molecule</span><span class="p">(</span><span class="n">inchi</span><span class="o">=</span><span class="n">inch</span><span class="p">)</span> <span class="k">for</span> <span class="n">inch</span> <span class="ow">in</span> <span class="n">inchi</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">smiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">smilesmod</span><span class="o">.</span><span class="n">smiles_to_molecule</span><span class="p">(</span><span class="n">smi</span><span class="o">=</span><span class="n">smil</span><span class="p">)</span> <span class="k">for</span> <span class="n">smil</span> <span class="ow">in</span> <span class="n">smiles</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">max_mols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_mols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span>

    <span class="n">opts</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolDrawOptions</span><span class="p">()</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">legendFraction</span> <span class="o">=</span> <span class="n">legend_fraction</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">legendFontSize</span> <span class="o">=</span> <span class="n">legend_fontsize</span>

    <span class="c1"># Save one molecule image using the grid image function</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mcs_smarts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Plotting only one molecule&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
            <span class="n">mols</span><span class="p">,</span>
            <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">subImgSize</span><span class="o">=</span><span class="n">sub_image_size</span><span class="p">,</span>
            <span class="n">legends</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">useSVG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">returnPNG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">maxMols</span><span class="o">=</span><span class="n">max_mols</span><span class="p">,</span>
            <span class="n">drawOptions</span><span class="o">=</span><span class="n">opts</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Get maximum common substructure across list of mols to align to</span>
        <span class="k">if</span> <span class="n">mcs_smarts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mcs_res</span> <span class="o">=</span> <span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span>
                <span class="n">mols</span><span class="p">,</span>
                <span class="n">completeRingsOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">matchChiralTag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">ringMatchesRingOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">mcs_smarts</span> <span class="o">=</span> <span class="n">mcs_res</span><span class="o">.</span><span class="n">smartsString</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MCS found: </span><span class="si">{</span><span class="n">mcs_smarts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">mcs_mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">mcs_smarts</span><span class="p">)</span>
        <span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">mcs_mol</span><span class="p">)</span>

        <span class="c1"># Align all molecules using the maximum common substructure</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mols</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GenerateDepictionMatching2DStructure</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mcs_mol</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">highlight_mcs</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">highlight_atom_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatch</span><span class="p">(</span><span class="n">mcs_mol</span><span class="p">)</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">mols</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">highlight_atom_list</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">mols_per_row</span><span class="p">:</span>
            <span class="n">mols_per_row</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span>

        <span class="c1"># Draw the grid image</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
            <span class="n">mols</span><span class="p">,</span>
            <span class="n">molsPerRow</span><span class="o">=</span><span class="n">mols_per_row</span><span class="p">,</span>
            <span class="n">subImgSize</span><span class="o">=</span><span class="n">sub_image_size</span><span class="p">,</span>
            <span class="n">legends</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">useSVG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">returnPNG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">maxMols</span><span class="o">=</span><span class="n">max_mols</span><span class="p">,</span>
            <span class="n">highlightAtomLists</span><span class="o">=</span><span class="n">highlight_atom_list</span><span class="p">,</span>
            <span class="n">drawOptions</span><span class="o">=</span><span class="n">opts</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># If there is a filename save the image to file</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_image</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">img</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">img</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">list_of_png_files_to_single_pdf</span><span class="p">(</span><span class="n">pngs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pdf_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;joined.pdf&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to make one PDF file from a list of image files and paths</span>

<span class="sd">    Args:</span>
<span class="sd">        pngs (list[str]): list of image files and paths</span>
<span class="sd">        pdf_filename (str, optional): The filename to save the PDF to. Defaults to &quot;joined.pdf&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span> <span class="k">for</span> <span class="n">fin</span> <span class="ow">in</span> <span class="n">pngs</span><span class="p">]</span>

    <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
        <span class="n">pdf_filename</span><span class="p">,</span> <span class="s2">&quot;PDF&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">images</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">molecule_similarity_maps</span><span class="p">(</span>
    <span class="n">exp_smiles</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">ref_smiles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ref_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exp_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">normalized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">fp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;morgan&quot;</span><span class="p">,</span>
    <span class="n">fp_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bv&quot;</span><span class="p">,</span>
    <span class="n">metric</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">TanimotoSimilarity</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to plot the similarity between two molecules as a coloured contour. See https://www.rdkit.org/docs/GettingStartedInPython.html#generating-similarity-maps-using-fingerprints for more information.</span>

<span class="sd">     Args:</span>
<span class="sd">         ref_smiles (str): Reference molecule smiles string</span>
<span class="sd">         exp_smiles (str): Experimental molecule smiles string</span>
<span class="sd">         ref_id (Optional[str], optional): A name or id for the reference molecule. Defaults to None.</span>
<span class="sd">         exp_id (Optional[str], optional): A name or id for the experimetal molecule. Defaults to None.</span>
<span class="sd">         filename (Optional[str], optional): Filename to save the image to. Defaults to None.</span>
<span class="sd">         weights (Optional[List[float]]): list of atomic contributions to use as weighting. Default to None.</span>
<span class="sd">         normalized (bool): whether to minmax normalize the weights or use the raw values. Defaults to False.</span>
<span class="sd">         radius (int, optional): radius of teh fingerprint if using morgan fingerprint. Defaults to 2.</span>
<span class="sd">         fp (str, optional): The fingerprint to use for a molecule rep. Options are: &#39;morgan&#39;, &#39;atompair&#39;, &#39;torsion&#39; or &#39;custom&#39; (use custom if passing in weights). Defaults to &quot;morgan&quot;.</span>
<span class="sd">         fp_type (str, optional): The type of fingerprint if using morgan. Use &#39;bv&#39; for binary and &#39;count&#39; for the number of occurence. Defaults to &quot;bv&quot;.</span>
<span class="sd">         metric (Callable, optional): Function to calculate similarity between the fingerprints. Defaults to DataStructs.TanimotoSimilarity.</span>

<span class="sd">     Raises:</span>
<span class="sd">         terr: If the wrong type is input for the fingerprint &#39;fp&#39; option</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">ref_smiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ref_mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">ref_smiles</span><span class="p">)</span>

    <span class="n">exp_mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">exp_smiles</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ref_smiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">ent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ref_id</span><span class="p">,</span> <span class="n">exp_id</span><span class="p">]):</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;similarity_map_</span><span class="si">{</span><span class="n">ref_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">exp_id</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;similarity_map_</span><span class="si">{</span><span class="n">CalcMolFormula</span><span class="p">(</span><span class="n">ref_mol</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">CalcMolFormula</span><span class="p">(</span><span class="n">exp_mol</span><span class="p">)</span><span class="si">}</span><span class="s2">.png&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exp_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;similarity_map_</span><span class="si">{</span><span class="n">exp_id</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;similarity_map_</span><span class="si">{</span><span class="n">CalcMolFormula</span><span class="p">(</span><span class="n">exp_mol</span><span class="p">)</span><span class="si">}</span><span class="s2">.png&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">terr</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">terr</span><span class="p">(</span>
            <span class="s2">&quot;fp type should be string one of &#39;morgan&#39;, &#39;atompair&#39;, &#39;torsion&#39; or &#39;custom&#39;&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">fp</span> <span class="o">==</span> <span class="s2">&quot;morgan&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">normalized</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetAtomicWeightsForFingerprint</span><span class="p">(</span>
                <span class="n">ref_mol</span><span class="p">,</span>
                <span class="n">exp_mol</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">inx</span><span class="p">:</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span>
                    <span class="n">m</span><span class="p">,</span> <span class="n">atomId</span><span class="o">=</span><span class="n">inx</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">fpType</span><span class="o">=</span><span class="n">fp_type</span>
                <span class="p">),</span>
                <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapFromWeights</span><span class="p">(</span>
                <span class="n">exp_mol</span><span class="p">,</span>
                <span class="n">weights</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">maxweight</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapForFingerprint</span><span class="p">(</span>
                <span class="n">ref_mol</span><span class="p">,</span>
                <span class="n">exp_mol</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">inx</span><span class="p">:</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span>
                    <span class="n">m</span><span class="p">,</span> <span class="n">atomId</span><span class="o">=</span><span class="n">inx</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">fpType</span><span class="o">=</span><span class="n">fp_type</span>
                <span class="p">),</span>
                <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max weight before normalization is </span><span class="si">{</span><span class="n">maxweight</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">fp</span> <span class="o">==</span> <span class="s2">&quot;atompair&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">normalized</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetAtomicWeightsForFingerprint</span><span class="p">(</span>
                <span class="n">ref_mol</span><span class="p">,</span> <span class="n">exp_mol</span><span class="p">,</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetAPFingerprint</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span>
            <span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapFromWeights</span><span class="p">(</span>
                <span class="n">exp_mol</span><span class="p">,</span>
                <span class="n">weights</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">maxweight</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapForFingerprint</span><span class="p">(</span>
                <span class="n">ref_mol</span><span class="p">,</span> <span class="n">exp_mol</span><span class="p">,</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetAPFingerprint</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max weight before normalization is </span><span class="si">{</span><span class="n">maxweight</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">fp</span> <span class="o">==</span> <span class="s2">&quot;torsion&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">normalized</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetAtomicWeightsForFingerprint</span><span class="p">(</span>
                <span class="n">ref_mol</span><span class="p">,</span> <span class="n">exp_mol</span><span class="p">,</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetTTFingerprint</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span>
            <span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapFromWeights</span><span class="p">(</span>
                <span class="n">exp_mol</span><span class="p">,</span>
                <span class="n">weights</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">maxweight</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapForFingerprint</span><span class="p">(</span>
                <span class="n">ref_mol</span><span class="p">,</span> <span class="n">exp_mol</span><span class="p">,</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetTTFingerprint</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max weight before normalization is </span><span class="si">{</span><span class="n">maxweight</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">normalized</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapFromWeights</span><span class="p">(</span><span class="n">exp_mol</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">weights_normed</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">weights</span>
            <span class="p">]</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapFromWeights</span><span class="p">(</span>
                <span class="n">exp_mol</span><span class="p">,</span> <span class="n">weights_normed</span><span class="p">,</span> <span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Min weight before normalization is </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="si">}</span><span class="s2">. Max weight before normalization is </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown options given fp should be one of &#39;morgan&#39;, &#39;atompair&#39; or &#39;torsion&#39; user has given </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s2"> or weights must not be None user has given </span><span class="si">{</span><span class="n">weights</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_tanimoto_matrix</span><span class="p">(</span>
    <span class="n">df1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">df2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labels_column_1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">smiles_column_1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">smiles_column_2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fps1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fps2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the symmetric Tanimoto similarity matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        df1 (Optional[pd.DataFrame], optional): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.</span>
<span class="sd">        df2 (Optional[pd.DataFrame], optional): Dataframe of the first set of smiles to compare to. These for the test cases to make the distrbution i.e. how similar is each molecule in this set to each one at a time from df1. Defaults to None.</span>
<span class="sd">        labels_column_1 (Optional[str], optional): The column containing labels from data set 1. Defaults to None.</span>
<span class="sd">        smiles_column_1 (Optional[str], optional): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        smiles_column_2 (Optional[str], optional): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.</span>
<span class="sd">        fps2 (Optional[list], optional): Precomputed fingerprints for df2. Defaults to None.</span>
<span class="sd">        dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Dataframe of the Tanimoto simialrity/distance matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">fps1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">fps2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Remove invalid smiles</span>
        <span class="n">valid_smiles_1_mask</span> <span class="o">=</span> <span class="n">smilesmod</span><span class="o">.</span><span class="n">get_valid_smiles_mask</span><span class="p">(</span>
            <span class="n">df1</span><span class="p">[</span><span class="n">smiles_column_1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dropping </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">valid_smiles_1_mask</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows from df1&quot;</span><span class="p">)</span>
        <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">valid_smiles_1_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
        <span class="n">valid_smiles_2_mask</span> <span class="o">=</span> <span class="n">smilesmod</span><span class="o">.</span><span class="n">get_valid_smiles_mask</span><span class="p">(</span>
            <span class="n">df2</span><span class="p">[</span><span class="n">smiles_column_2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dropping </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">valid_smiles_2_mask</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows from df2&quot;</span><span class="p">)</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="n">valid_smiles_2_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>

        <span class="c1"># Get ECFP4 fingerprints</span>
        <span class="n">fps1</span> <span class="o">=</span> <span class="n">featurization</span><span class="o">.</span><span class="n">get_ecfp</span><span class="p">(</span>
            <span class="n">df1</span><span class="p">,</span> <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column_1</span><span class="p">,</span> <span class="n">hash_length</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">fps2</span> <span class="o">=</span> <span class="n">featurization</span><span class="o">.</span><span class="n">get_ecfp</span><span class="p">(</span>
            <span class="n">df2</span><span class="p">,</span> <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column_2</span><span class="p">,</span> <span class="n">hash_length</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>

    <span class="c1"># Calculate Tanimoto simialrity matrix</span>
    <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">DataStructs</span><span class="o">.</span><span class="n">BulkTanimotoSimilarity</span><span class="p">(</span><span class="n">fps1</span><span class="p">[</span><span class="n">ith</span><span class="p">],</span> <span class="n">fps2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ith</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fps1</span><span class="p">))</span>
        <span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">tanimoto_measures</span> <span class="o">-</span> <span class="mf">1.0</span>
    <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tanimoto_measures</span><span class="p">)</span>
    <span class="n">tanimoto_measures</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">labels_column_1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">tanimoto_measures</span>


<span class="k">def</span><span class="w"> </span><span class="nf">tanimoto_box_plot</span><span class="p">(</span>
    <span class="n">df1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">df2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">labels_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">smiles_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">smiles_column_2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tanimoto_box_plot.png&quot;</span><span class="p">,</span>
    <span class="n">fps1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fps2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the symmetric Tanimoto similarity matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        df1 (pd.DataFrame): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.</span>
<span class="sd">        df2 (pd.DataFrame): Dataframe of the first set of smiles to compare to. These for the test cases to make the distrbution i.e. how similar is each molecule in this set to each one at a time from df1. Defaults to None.</span>
<span class="sd">        labels_column_1 (str): The column containing labels from data set 1. Defaults to None.</span>
<span class="sd">        smiles_column_1 (str): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        smiles_column_2 (str): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        filename (str): the file to save the plot to</span>
<span class="sd">        fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.</span>
<span class="sd">        fps2 (Optional[list], optional): Precomputed fingerprints for df2. Defaults to None.</span>
<span class="sd">        dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">get_tanimoto_matrix</span><span class="p">(</span>
        <span class="n">df1</span><span class="p">,</span>
        <span class="n">df2</span><span class="p">,</span>
        <span class="n">labels_column_1</span><span class="p">,</span>
        <span class="n">smiles_column_1</span><span class="p">,</span>
        <span class="n">smiles_column_2</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span>
        <span class="n">fps1</span><span class="o">=</span><span class="n">fps1</span><span class="p">,</span>
        <span class="n">fps2</span><span class="o">=</span><span class="n">fps2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># plot box plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tanimoto_measures</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">tanimoto_measures</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">rot</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Molecule Labels&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Tanimoto Smiliarlity&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Tanimoto Distance&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">tanimoto_distrbution_plots</span><span class="p">(</span>
    <span class="n">df1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">df2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">labels_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">smiles_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">smiles_column_2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tanimoto_distrbution_plot.png&quot;</span><span class="p">,</span>
    <span class="n">fps1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fps2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the symmetric Tanimoto similarity matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        df1 (pd.DataFrame): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.</span>
<span class="sd">        df2 (pd.DataFrame): Dataframe of the first set of smiles to compare to. These for the test cases to make the distrbution i.e. how similar is each molecule in this set to each one at a time from df1. Defaults to None.</span>
<span class="sd">        labels_column_1 (str): The column containing labels from data set 1. Defaults to None.</span>
<span class="sd">        smiles_column_1 (str): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        smiles_column_2 (str): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        filename (str): the file to save the plot to</span>
<span class="sd">        fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.</span>
<span class="sd">        fps2 (Optional[list], optional): Precomputed fingerprints for df2. Defaults to None.</span>
<span class="sd">        dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tm_mat</span> <span class="o">=</span> <span class="n">get_tanimoto_matrix</span><span class="p">(</span>
        <span class="n">df1</span><span class="p">,</span>
        <span class="n">df2</span><span class="p">,</span>
        <span class="n">labels_column_1</span><span class="o">=</span><span class="n">labels_column_1</span><span class="p">,</span>
        <span class="n">smiles_column_1</span><span class="o">=</span><span class="n">smiles_column_1</span><span class="p">,</span>
        <span class="n">smiles_column_2</span><span class="o">=</span><span class="n">smiles_column_2</span><span class="p">,</span>
        <span class="n">fps1</span><span class="o">=</span><span class="n">fps1</span><span class="p">,</span>
        <span class="n">fps2</span><span class="o">=</span><span class="n">fps2</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">medians</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tm_mat</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">])</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tm_mat</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">indx_med</span><span class="p">,</span> <span class="n">indx_mean</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">medians</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">means</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">indx_med</span> <span class="o">!=</span> <span class="n">indx_mean</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Indexes are different between the mean and median series!&quot;</span>
            <span class="p">)</span>

    <span class="n">averages</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">medians</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">averages</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">kde</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">colormap</span><span class="o">=</span><span class="s2">&quot;bwr&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Average Tanimoto Similarity Distrbution&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Average Tanimoto Distance Distrbution&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_tanimoto_intra_dataset_matrix</span><span class="p">(</span>
    <span class="n">df1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labels_column_1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">smiles_column_1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fps1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the symmetric Tanimoto similarity matrix of all molecules in a data set to all other molecules in that dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        df1 (Optional[pd.DataFrame], optional): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.</span>
<span class="sd">        labels_column_1 (Optional[str], optional): The column containing labels from data set 1. Defaults to None.</span>
<span class="sd">        smiles_column_1 (Optional[str], optional): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.</span>
<span class="sd">        dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Dataframe of the Tanimoto simialrity/distance matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">fps1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Remove invalid smiles</span>
        <span class="n">valid_smiles_1_mask</span> <span class="o">=</span> <span class="n">smilesmod</span><span class="o">.</span><span class="n">get_valid_smiles_mask</span><span class="p">(</span>
            <span class="n">df1</span><span class="p">[</span><span class="n">smiles_column_1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dropping </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">valid_smiles_1_mask</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows from df1&quot;</span><span class="p">)</span>
        <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">valid_smiles_1_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>

        <span class="c1"># Get ECFP4 fingerprints</span>
        <span class="n">fps1</span> <span class="o">=</span> <span class="n">featurization</span><span class="o">.</span><span class="n">get_ecfp</span><span class="p">(</span>
            <span class="n">df1</span><span class="p">,</span> <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column_1</span><span class="p">,</span> <span class="n">hash_length</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>

    <span class="c1"># Calculate Tanimoto simialrity matrix</span>
    <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">DataStructs</span><span class="o">.</span><span class="n">BulkTanimotoSimilarity</span><span class="p">(</span><span class="n">fps1</span><span class="p">[</span><span class="n">ith</span><span class="p">],</span> <span class="n">fps1</span><span class="p">[:</span><span class="n">ith</span><span class="p">]</span> <span class="o">+</span> <span class="n">fps1</span><span class="p">[</span><span class="n">ith</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:])</span>
            <span class="k">for</span> <span class="n">ith</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fps1</span><span class="p">))</span>
        <span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">tanimoto_measures</span> <span class="o">-</span> <span class="mf">1.0</span>
    <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tanimoto_measures</span><span class="p">)</span>
    <span class="n">tanimoto_measures</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">labels_column_1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">tanimoto_measures</span>


<span class="k">def</span><span class="w"> </span><span class="nf">tanimoto_intra_dataset_box_plot</span><span class="p">(</span>
    <span class="n">df1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">labels_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">smiles_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tanimoto_box_plot.png&quot;</span><span class="p">,</span>
    <span class="n">fps1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the symmetric Tanimoto similarity matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        df1 (pd.DataFrame): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.</span>
<span class="sd">        labels_column_1 (str): The column containing labels from data set 1. Defaults to None.</span>
<span class="sd">        smiles_column_1 (str): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        filename (str): the file to save the plot to</span>
<span class="sd">        fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.</span>
<span class="sd">        dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">get_tanimoto_intra_dataset_matrix</span><span class="p">(</span>
        <span class="n">df1</span><span class="p">,</span>
        <span class="n">labels_column_1</span><span class="p">,</span>
        <span class="n">smiles_column_1</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span>
        <span class="n">fps1</span><span class="o">=</span><span class="n">fps1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">tanimoto_measures</span><span class="p">)</span>

    <span class="c1"># plot box plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tanimoto_measures</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">tanimoto_measures</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">rot</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Molecule Labels&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Tanimoto Smiliarlity&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Tanimoto Distance&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">tanimoto_distrbution_plots_intra_dataset</span><span class="p">(</span>
    <span class="n">df1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">labels_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">smiles_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tanimoto_distrbution_plot.png&quot;</span><span class="p">,</span>
    <span class="n">fps1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the symmetric Tanimoto similarity matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        df1 (pd.DataFrame): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.</span>
<span class="sd">        labels_column_1 (str): The column containing labels from data set 1. Defaults to None.</span>
<span class="sd">        smiles_column_1 (str): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        filename (str): the file to save the plot to</span>
<span class="sd">        fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.</span>
<span class="sd">        dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tm_mat</span> <span class="o">=</span> <span class="n">get_tanimoto_intra_dataset_matrix</span><span class="p">(</span>
        <span class="n">df1</span><span class="p">,</span>
        <span class="n">labels_column_1</span><span class="o">=</span><span class="n">labels_column_1</span><span class="p">,</span>
        <span class="n">smiles_column_1</span><span class="o">=</span><span class="n">smiles_column_1</span><span class="p">,</span>
        <span class="n">fps1</span><span class="o">=</span><span class="n">fps1</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">medians</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tm_mat</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">])</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tm_mat</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">indx_med</span><span class="p">,</span> <span class="n">indx_mean</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">medians</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">means</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">indx_med</span> <span class="o">!=</span> <span class="n">indx_mean</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Indexes are different between the mean and median series!&quot;</span>
            <span class="p">)</span>

    <span class="n">averages</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">medians</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">averages</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">kde</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">colormap</span><span class="o">=</span><span class="s2">&quot;bwr&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Average Tanimoto Similarity Distrbution&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Average Tanimoto Distance Distrbution&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">seaborn_pair_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">subset_colummns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pair_plot.png&quot;</span><span class="p">,</span>
    <span class="n">row_column_scaler</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
    <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;reg&quot;</span><span class="p">,</span>
    <span class="n">diag_kind</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;kde&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to plot a seaborn pair plot of a dataframe</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): The dataframe to plot</span>
<span class="sd">        subset_colummns (Optional[List[str]], optional): The columns to subset the dataframe to. Defaults to None.</span>
<span class="sd">        width (int, optional): The width of the column names. Defaults to 15.</span>
<span class="sd">        filename (str, optional): Filename to save the plot to. Defaults to &quot;pair_plot.png&quot;.</span>
<span class="sd">        row_column_scaler (float, optional): The scaler to multiply the row and column size by. Defaults to 2.0.</span>
<span class="sd">        kind (str, optional): The kind of plot to use. Defaults to &quot;reg&quot;.</span>
<span class="sd">        diag_kind (str, optional): The kind of plot to use on the diagonal. Defaults to &quot;kde&quot;.</span>
<span class="sd">        title (Optional[str], optional): The title of the plot. Defaults to None.</span>
<span class="sd">        fontsize (int, optional): The fontsize of the title. Defaults to 20.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Axes: The axis of the plot</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">subset_colummns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">subset_colummns</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
            <span class="n">row_column_scaler</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
            <span class="n">row_column_scaler</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="n">diag_kind</span><span class="o">=</span><span class="n">diag_kind</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">seaborn_correlation_heat_map</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">subset_colummns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;heat_map.png&quot;</span><span class="p">,</span>
    <span class="n">row_column_scaler</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
    <span class="n">square</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">vmin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pearson&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to plot a seaborn correlation heat map of a dataframe</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): The dataframe to plot</span>
<span class="sd">        subset_colummns (Optional[List[str]], optional): The columns to subset the dataframe to. Defaults to None.</span>
<span class="sd">        width (int, optional): The width of the column names. Defaults to 15.</span>
<span class="sd">        filename (str, optional): Filename to save the plot to. Defaults to &quot;heat_map.png&quot;.</span>
<span class="sd">        row_column_scaler (float, optional): The scaler to multiply the row and column size by. Defaults to 2.0.</span>
<span class="sd">        square (bool, optional): Whether to make the plot square. Defaults to True.</span>
<span class="sd">        vmin (float, optional): The minimum value of the colour map. Defaults to -1.0.</span>
<span class="sd">        vmax (float, optional): The maximum value of the colour map. Defaults to 1.0.</span>
<span class="sd">        method (Union[str, Callable], optional): The method to calculate the correlation. Defaults to &quot;pearson&quot;.</span>
<span class="sd">        title (Optional[str], optional): The title of the plot. Defaults to None.</span>
<span class="sd">        xlabel (Optional[str], optional): The x axis label. Defaults to None.</span>
<span class="sd">        ylabel (Optional[str], optional): The y axis label. Defaults to None.</span>
<span class="sd">        fontsize (int, optional): The fontsize of the title. Defaults to 20.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Axes: The axis of the plot</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">subset_colummns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">subset_colummns</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
            <span class="n">row_column_scaler</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
            <span class="n">row_column_scaler</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">),</span>
        <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
        <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">square</span><span class="o">=</span><span class="n">square</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="chemutil.vis.log" class="name">var <span class="ident">log</span></p>


  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>

  <div class="item">
    <div class="name def" id="chemutil.vis.draw_aligned_mol_grid">
    <p>def <span class="ident">draw_aligned_mol_grid</span>(</p><p>mols: Optional[List[rdkit.Chem.rdchem.Mol]] = None, smiles: Optional[List[str]] = None, inchi: Optional[List[str]] = None, mcs_smarts: Optional[str] = None, labels: Optional[List[str]] = None, mols_per_row: int = 5, sub_image_size: Tuple[int, int] = (400, 400), filename: Optional[str] = None, max_mols: Optional[int] = None, return_image: bool = True, legend_fontsize: int = 20, legend_fraction: float = 0.1, highlight_mcs: bool = False)</p>
    </div>




    <div class="desc"><p>Draw a grid of molecule images and write to file if requested. Return the raw image object.</p>
<p>Args:
    mols (Optional[List[rdkit.rdMol.Mol]], optional): List of RDKit molecule objects. Defaults to None.
    smiles (Optional[List[str]], optional): List of smiles strings. Defaults to None.
    inchi (Optional[List[str]], optional): List of InChi strings. Defaults to None.
    mcs_smarts (Optional[List[str]], optional): Pre computed maximum common substructure smarts string. Defaults to None.
    labels (Optional[List[str]], optional): List of string labels for the molecules. Defaults to None.
    mols_per_row (int, optional): number of molecules to show in each row. Defaults to 5.
    sub_image_size (Tuple[int, int], optional): the size in pixels of each molecule image. Defaults to (400, 400).
    filename (Optional[str], optional): What to save the image as if None it is not saved. Defaults to None.
    max_mols (Optional[int], optional): The max mols to show in a grid plot None plot all. Defaults to None.</p>
<p>Raises:
    UserWarning: If None of the molecules formats are provided by the use</p>
<p>Returns:
    PIL.PngImagePlugin.PngImageFile: Raw image object (.save(file) to save the image)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.vis.draw_aligned_mol_grid', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.vis.draw_aligned_mol_grid" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">draw_aligned_mol_grid</span><span class="p">(</span>
    <span class="n">mols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">Mol</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">smiles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">inchi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mcs_smarts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mols_per_row</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">sub_image_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_mols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">legend_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">highlight_mcs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PngImageFile</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw a grid of molecule images and write to file if requested. Return the raw image object.</span>

<span class="sd">    Args:</span>
<span class="sd">        mols (Optional[List[rdkit.rdMol.Mol]], optional): List of RDKit molecule objects. Defaults to None.</span>
<span class="sd">        smiles (Optional[List[str]], optional): List of smiles strings. Defaults to None.</span>
<span class="sd">        inchi (Optional[List[str]], optional): List of InChi strings. Defaults to None.</span>
<span class="sd">        mcs_smarts (Optional[List[str]], optional): Pre computed maximum common substructure smarts string. Defaults to None.</span>
<span class="sd">        labels (Optional[List[str]], optional): List of string labels for the molecules. Defaults to None.</span>
<span class="sd">        mols_per_row (int, optional): number of molecules to show in each row. Defaults to 5.</span>
<span class="sd">        sub_image_size (Tuple[int, int], optional): the size in pixels of each molecule image. Defaults to (400, 400).</span>
<span class="sd">        filename (Optional[str], optional): What to save the image as if None it is not saved. Defaults to None.</span>
<span class="sd">        max_mols (Optional[int], optional): The max mols to show in a grid plot None plot all. Defaults to None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        UserWarning: If None of the molecules formats are provided by the use</span>

<span class="sd">    Returns:</span>
<span class="sd">        PIL.PngImagePlugin.PngImageFile: Raw image object (.save(file) to save the image)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check the user has input one of the required inputs</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">ent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mols</span><span class="p">,</span> <span class="n">smiles</span><span class="p">,</span> <span class="n">inchi</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="s2">&quot;One of mols, smiles or inchi must be given for input&quot;</span><span class="p">)</span>

    <span class="c1"># Make sure there is a list of molecules</span>
    <span class="k">if</span> <span class="n">mols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># smiles is the lowest priority</span>
        <span class="k">if</span> <span class="n">inchi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">inchimod</span><span class="o">.</span><span class="n">inchi_to_molecule</span><span class="p">(</span><span class="n">inchi</span><span class="o">=</span><span class="n">inch</span><span class="p">)</span> <span class="k">for</span> <span class="n">inch</span> <span class="ow">in</span> <span class="n">inchi</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">smiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">smilesmod</span><span class="o">.</span><span class="n">smiles_to_molecule</span><span class="p">(</span><span class="n">smi</span><span class="o">=</span><span class="n">smil</span><span class="p">)</span> <span class="k">for</span> <span class="n">smil</span> <span class="ow">in</span> <span class="n">smiles</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">max_mols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_mols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span>

    <span class="n">opts</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolDrawOptions</span><span class="p">()</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">legendFraction</span> <span class="o">=</span> <span class="n">legend_fraction</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">legendFontSize</span> <span class="o">=</span> <span class="n">legend_fontsize</span>

    <span class="c1"># Save one molecule image using the grid image function</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mcs_smarts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Plotting only one molecule&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
            <span class="n">mols</span><span class="p">,</span>
            <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">subImgSize</span><span class="o">=</span><span class="n">sub_image_size</span><span class="p">,</span>
            <span class="n">legends</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">useSVG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">returnPNG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">maxMols</span><span class="o">=</span><span class="n">max_mols</span><span class="p">,</span>
            <span class="n">drawOptions</span><span class="o">=</span><span class="n">opts</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Get maximum common substructure across list of mols to align to</span>
        <span class="k">if</span> <span class="n">mcs_smarts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mcs_res</span> <span class="o">=</span> <span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span>
                <span class="n">mols</span><span class="p">,</span>
                <span class="n">completeRingsOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">matchChiralTag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">ringMatchesRingOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">mcs_smarts</span> <span class="o">=</span> <span class="n">mcs_res</span><span class="o">.</span><span class="n">smartsString</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MCS found: </span><span class="si">{</span><span class="n">mcs_smarts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">mcs_mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">mcs_smarts</span><span class="p">)</span>
        <span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">mcs_mol</span><span class="p">)</span>

        <span class="c1"># Align all molecules using the maximum common substructure</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mols</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GenerateDepictionMatching2DStructure</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mcs_mol</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">highlight_mcs</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">highlight_atom_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatch</span><span class="p">(</span><span class="n">mcs_mol</span><span class="p">)</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">mols</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">highlight_atom_list</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">mols_per_row</span><span class="p">:</span>
            <span class="n">mols_per_row</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span>

        <span class="c1"># Draw the grid image</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
            <span class="n">mols</span><span class="p">,</span>
            <span class="n">molsPerRow</span><span class="o">=</span><span class="n">mols_per_row</span><span class="p">,</span>
            <span class="n">subImgSize</span><span class="o">=</span><span class="n">sub_image_size</span><span class="p">,</span>
            <span class="n">legends</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">useSVG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">returnPNG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">maxMols</span><span class="o">=</span><span class="n">max_mols</span><span class="p">,</span>
            <span class="n">highlightAtomLists</span><span class="o">=</span><span class="n">highlight_atom_list</span><span class="p">,</span>
            <span class="n">drawOptions</span><span class="o">=</span><span class="n">opts</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># If there is a filename save the image to file</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_image</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">img</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">img</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.vis.draw_molecule_to_file">
    <p>def <span class="ident">draw_molecule_to_file</span>(</p><p>mol: Optional[rdkit.Chem.rdchem.Mol] = None, smiles: Optional[str] = None, inchi: Optional[str] = None, mcs_smarts: Optional[str] = None, labels: Optional[List[str]] = None, image_size: Tuple[int, int] = (400, 400), filename: Optional[str] = None)</p>
    </div>




    <div class="desc"><p>Draw a molecule image and write to file if requested. Return the raw image object.</p>
<p>Args:
    mols (Optional[List[rdkit.rdMol.Mol]], optional): List of RDKit molecule objects. Defaults to None.
    smiles (Optional[List[str]], optional): List of smiles strings. Defaults to None.
    inchi (Optional[List[str]], optional): List of InChi strings. Defaults to None.
    mcs_smarts (Optional[List[str]], optional): Pre computed maximum common substructure smarts string. Defaults to None.
    labels (Optional[List[str]], optional): List of string labels for the molecules. Defaults to None.
    sub_image_size (Tuple[int, int], optional): the size in pixels of each molecule image. Defaults to (400, 400).
    filename (Optional[str], optional): What to save the image as if None it is not saved. Defaults to None.</p>
<p>Raises:
    UserWarning: If None of the molecules formats are provided by the use</p>
<p>Returns:
    PIL.PngImagePlugin.PngImageFile: Raw image object (.save(file) to save the image)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.vis.draw_molecule_to_file', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.vis.draw_molecule_to_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">draw_molecule_to_file</span><span class="p">(</span>
    <span class="n">mol</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">Mol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">smiles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">inchi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mcs_smarts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">image_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PngImageFile</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw a molecule image and write to file if requested. Return the raw image object.</span>

<span class="sd">    Args:</span>
<span class="sd">        mols (Optional[List[rdkit.rdMol.Mol]], optional): List of RDKit molecule objects. Defaults to None.</span>
<span class="sd">        smiles (Optional[List[str]], optional): List of smiles strings. Defaults to None.</span>
<span class="sd">        inchi (Optional[List[str]], optional): List of InChi strings. Defaults to None.</span>
<span class="sd">        mcs_smarts (Optional[List[str]], optional): Pre computed maximum common substructure smarts string. Defaults to None.</span>
<span class="sd">        labels (Optional[List[str]], optional): List of string labels for the molecules. Defaults to None.</span>
<span class="sd">        sub_image_size (Tuple[int, int], optional): the size in pixels of each molecule image. Defaults to (400, 400).</span>
<span class="sd">        filename (Optional[str], optional): What to save the image as if None it is not saved. Defaults to None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        UserWarning: If None of the molecules formats are provided by the use</span>

<span class="sd">    Returns:</span>
<span class="sd">        PIL.PngImagePlugin.PngImageFile: Raw image object (.save(file) to save the image)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check the user has input one of the required inputs</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">ent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mol</span><span class="p">,</span> <span class="n">smiles</span><span class="p">,</span> <span class="n">inchi</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="s2">&quot;One of mols, smiles or inchi must be given for input&quot;</span><span class="p">)</span>

    <span class="c1"># Make sure there is a list of molecules</span>
    <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># smiles is the lowest priority</span>
        <span class="k">if</span> <span class="n">inchi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">inchimod</span><span class="o">.</span><span class="n">inchi_to_molecule</span><span class="p">(</span><span class="n">inchi</span><span class="o">=</span><span class="n">inchi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">smiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">smilesmod</span><span class="o">.</span><span class="n">smiles_to_molecule</span><span class="p">(</span><span class="n">smi</span><span class="o">=</span><span class="n">smiles</span><span class="p">)</span>

    <span class="c1"># one moleucle image code aligned to the mcs smarts from a user or not when not avaliable</span>
    <span class="k">if</span> <span class="n">mcs_smarts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolToImage</span><span class="p">(</span>
            <span class="n">mol</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span> <span class="n">kekulize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wedgeBonds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legends</span><span class="o">=</span><span class="n">labels</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mcs_mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">mcs_smarts</span><span class="p">)</span>
        <span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">mcs_mol</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GenerateDepictionMatching2DStructure</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mcs_mol</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolToImage</span><span class="p">(</span>
            <span class="n">mol</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span> <span class="n">kekulize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wedgeBonds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legends</span><span class="o">=</span><span class="n">labels</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">img</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.vis.get_tanimoto_intra_dataset_matrix">
    <p>def <span class="ident">get_tanimoto_intra_dataset_matrix</span>(</p><p>df1: Optional[pandas.core.frame.DataFrame] = None, labels_column_1: Optional[str] = None, smiles_column_1: Optional[str] = None, fps1: Optional[list] = None, dist: bool = False)</p>
    </div>




    <div class="desc"><p>Function to calculate the symmetric Tanimoto similarity matrix of all molecules in a data set to all other molecules in that dataset</p>
<p>Args:
    df1 (Optional[pd.DataFrame], optional): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.
    labels_column_1 (Optional[str], optional): The column containing labels from data set 1. Defaults to None.
    smiles_column_1 (Optional[str], optional): The column containing smiles for the molecules. Defaults to None.
    fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.
    dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</p>
<p>Returns:
    pd.DataFrame: Dataframe of the Tanimoto simialrity/distance matrix</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.vis.get_tanimoto_intra_dataset_matrix', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.vis.get_tanimoto_intra_dataset_matrix" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_tanimoto_intra_dataset_matrix</span><span class="p">(</span>
    <span class="n">df1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labels_column_1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">smiles_column_1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fps1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the symmetric Tanimoto similarity matrix of all molecules in a data set to all other molecules in that dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        df1 (Optional[pd.DataFrame], optional): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.</span>
<span class="sd">        labels_column_1 (Optional[str], optional): The column containing labels from data set 1. Defaults to None.</span>
<span class="sd">        smiles_column_1 (Optional[str], optional): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.</span>
<span class="sd">        dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Dataframe of the Tanimoto simialrity/distance matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">fps1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Remove invalid smiles</span>
        <span class="n">valid_smiles_1_mask</span> <span class="o">=</span> <span class="n">smilesmod</span><span class="o">.</span><span class="n">get_valid_smiles_mask</span><span class="p">(</span>
            <span class="n">df1</span><span class="p">[</span><span class="n">smiles_column_1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dropping </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">valid_smiles_1_mask</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows from df1&quot;</span><span class="p">)</span>
        <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">valid_smiles_1_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>

        <span class="c1"># Get ECFP4 fingerprints</span>
        <span class="n">fps1</span> <span class="o">=</span> <span class="n">featurization</span><span class="o">.</span><span class="n">get_ecfp</span><span class="p">(</span>
            <span class="n">df1</span><span class="p">,</span> <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column_1</span><span class="p">,</span> <span class="n">hash_length</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>

    <span class="c1"># Calculate Tanimoto simialrity matrix</span>
    <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">DataStructs</span><span class="o">.</span><span class="n">BulkTanimotoSimilarity</span><span class="p">(</span><span class="n">fps1</span><span class="p">[</span><span class="n">ith</span><span class="p">],</span> <span class="n">fps1</span><span class="p">[:</span><span class="n">ith</span><span class="p">]</span> <span class="o">+</span> <span class="n">fps1</span><span class="p">[</span><span class="n">ith</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:])</span>
            <span class="k">for</span> <span class="n">ith</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fps1</span><span class="p">))</span>
        <span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">tanimoto_measures</span> <span class="o">-</span> <span class="mf">1.0</span>
    <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tanimoto_measures</span><span class="p">)</span>
    <span class="n">tanimoto_measures</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">labels_column_1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">tanimoto_measures</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.vis.get_tanimoto_matrix">
    <p>def <span class="ident">get_tanimoto_matrix</span>(</p><p>df1: Optional[pandas.core.frame.DataFrame] = None, df2: Optional[pandas.core.frame.DataFrame] = None, labels_column_1: Optional[str] = None, smiles_column_1: Optional[str] = None, smiles_column_2: Optional[str] = None, fps1: Optional[list] = None, fps2: Optional[list] = None, dist: bool = False)</p>
    </div>




    <div class="desc"><p>Function to calculate the symmetric Tanimoto similarity matrix</p>
<p>Args:
    df1 (Optional[pd.DataFrame], optional): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.
    df2 (Optional[pd.DataFrame], optional): Dataframe of the first set of smiles to compare to. These for the test cases to make the distrbution i.e. how similar is each molecule in this set to each one at a time from df1. Defaults to None.
    labels_column_1 (Optional[str], optional): The column containing labels from data set 1. Defaults to None.
    smiles_column_1 (Optional[str], optional): The column containing smiles for the molecules. Defaults to None.
    smiles_column_2 (Optional[str], optional): The column containing smiles for the molecules. Defaults to None.
    fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.
    fps2 (Optional[list], optional): Precomputed fingerprints for df2. Defaults to None.
    dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</p>
<p>Returns:
    pd.DataFrame: Dataframe of the Tanimoto simialrity/distance matrix</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.vis.get_tanimoto_matrix', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.vis.get_tanimoto_matrix" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_tanimoto_matrix</span><span class="p">(</span>
    <span class="n">df1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">df2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labels_column_1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">smiles_column_1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">smiles_column_2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fps1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fps2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the symmetric Tanimoto similarity matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        df1 (Optional[pd.DataFrame], optional): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.</span>
<span class="sd">        df2 (Optional[pd.DataFrame], optional): Dataframe of the first set of smiles to compare to. These for the test cases to make the distrbution i.e. how similar is each molecule in this set to each one at a time from df1. Defaults to None.</span>
<span class="sd">        labels_column_1 (Optional[str], optional): The column containing labels from data set 1. Defaults to None.</span>
<span class="sd">        smiles_column_1 (Optional[str], optional): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        smiles_column_2 (Optional[str], optional): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.</span>
<span class="sd">        fps2 (Optional[list], optional): Precomputed fingerprints for df2. Defaults to None.</span>
<span class="sd">        dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Dataframe of the Tanimoto simialrity/distance matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">fps1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">fps2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Remove invalid smiles</span>
        <span class="n">valid_smiles_1_mask</span> <span class="o">=</span> <span class="n">smilesmod</span><span class="o">.</span><span class="n">get_valid_smiles_mask</span><span class="p">(</span>
            <span class="n">df1</span><span class="p">[</span><span class="n">smiles_column_1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dropping </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">valid_smiles_1_mask</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows from df1&quot;</span><span class="p">)</span>
        <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">valid_smiles_1_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
        <span class="n">valid_smiles_2_mask</span> <span class="o">=</span> <span class="n">smilesmod</span><span class="o">.</span><span class="n">get_valid_smiles_mask</span><span class="p">(</span>
            <span class="n">df2</span><span class="p">[</span><span class="n">smiles_column_2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dropping </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">valid_smiles_2_mask</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows from df2&quot;</span><span class="p">)</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="n">valid_smiles_2_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>

        <span class="c1"># Get ECFP4 fingerprints</span>
        <span class="n">fps1</span> <span class="o">=</span> <span class="n">featurization</span><span class="o">.</span><span class="n">get_ecfp</span><span class="p">(</span>
            <span class="n">df1</span><span class="p">,</span> <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column_1</span><span class="p">,</span> <span class="n">hash_length</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">fps2</span> <span class="o">=</span> <span class="n">featurization</span><span class="o">.</span><span class="n">get_ecfp</span><span class="p">(</span>
            <span class="n">df2</span><span class="p">,</span> <span class="n">smiles_column</span><span class="o">=</span><span class="n">smiles_column_2</span><span class="p">,</span> <span class="n">hash_length</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>

    <span class="c1"># Calculate Tanimoto simialrity matrix</span>
    <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">DataStructs</span><span class="o">.</span><span class="n">BulkTanimotoSimilarity</span><span class="p">(</span><span class="n">fps1</span><span class="p">[</span><span class="n">ith</span><span class="p">],</span> <span class="n">fps2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ith</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fps1</span><span class="p">))</span>
        <span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">tanimoto_measures</span> <span class="o">-</span> <span class="mf">1.0</span>
    <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tanimoto_measures</span><span class="p">)</span>
    <span class="n">tanimoto_measures</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">labels_column_1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">tanimoto_measures</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.vis.list_of_png_files_to_single_pdf">
    <p>def <span class="ident">list_of_png_files_to_single_pdf</span>(</p><p>pngs: List[str], pdf_filename: str = &#39;joined.pdf&#39;)</p>
    </div>




    <div class="desc"><p>Function to make one PDF file from a list of image files and paths</p>
<p>Args:
    pngs (list[str]): list of image files and paths
    pdf_filename (str, optional): The filename to save the PDF to. Defaults to "joined.pdf".</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.vis.list_of_png_files_to_single_pdf', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.vis.list_of_png_files_to_single_pdf" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">list_of_png_files_to_single_pdf</span><span class="p">(</span><span class="n">pngs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pdf_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;joined.pdf&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to make one PDF file from a list of image files and paths</span>

<span class="sd">    Args:</span>
<span class="sd">        pngs (list[str]): list of image files and paths</span>
<span class="sd">        pdf_filename (str, optional): The filename to save the PDF to. Defaults to &quot;joined.pdf&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span> <span class="k">for</span> <span class="n">fin</span> <span class="ow">in</span> <span class="n">pngs</span><span class="p">]</span>

    <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
        <span class="n">pdf_filename</span><span class="p">,</span> <span class="s2">&quot;PDF&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">images</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.vis.molecule_similarity_maps">
    <p>def <span class="ident">molecule_similarity_maps</span>(</p><p>exp_smiles: str, ref_smiles: Optional[str] = None, ref_id: Optional[str] = None, exp_id: Optional[str] = None, filename: Optional[str] = None, weights: Optional[List[float]] = None, normalized: bool = False, radius: int = 2, fp: str = &#39;morgan&#39;, fp_type: str = &#39;bv&#39;, metric: Callable = &lt;Boost.Python.function object at 0x6000012ce710&gt;, **kwargs)</p>
    </div>




    <div class="desc"><p>Function to plot the similarity between two molecules as a coloured contour. See https://www.rdkit.org/docs/GettingStartedInPython.html#generating-similarity-maps-using-fingerprints for more information.</p>
<p>Args:
    ref_smiles (str): Reference molecule smiles string
    exp_smiles (str): Experimental molecule smiles string
    ref_id (Optional[str], optional): A name or id for the reference molecule. Defaults to None.
    exp_id (Optional[str], optional): A name or id for the experimetal molecule. Defaults to None.
    filename (Optional[str], optional): Filename to save the image to. Defaults to None.
    weights (Optional[List[float]]): list of atomic contributions to use as weighting. Default to None.
    normalized (bool): whether to minmax normalize the weights or use the raw values. Defaults to False.
    radius (int, optional): radius of teh fingerprint if using morgan fingerprint. Defaults to 2.
    fp (str, optional): The fingerprint to use for a molecule rep. Options are: 'morgan', 'atompair', 'torsion' or 'custom' (use custom if passing in weights). Defaults to "morgan".
    fp_type (str, optional): The type of fingerprint if using morgan. Use 'bv' for binary and 'count' for the number of occurence. Defaults to "bv".
    metric (Callable, optional): Function to calculate similarity between the fingerprints. Defaults to DataStructs.TanimotoSimilarity.</p>
<p>Raises:
    terr: If the wrong type is input for the fingerprint 'fp' option</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.vis.molecule_similarity_maps', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.vis.molecule_similarity_maps" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">molecule_similarity_maps</span><span class="p">(</span>
    <span class="n">exp_smiles</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">ref_smiles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ref_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exp_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">normalized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">fp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;morgan&quot;</span><span class="p">,</span>
    <span class="n">fp_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bv&quot;</span><span class="p">,</span>
    <span class="n">metric</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">TanimotoSimilarity</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to plot the similarity between two molecules as a coloured contour. See https://www.rdkit.org/docs/GettingStartedInPython.html#generating-similarity-maps-using-fingerprints for more information.</span>

<span class="sd">     Args:</span>
<span class="sd">         ref_smiles (str): Reference molecule smiles string</span>
<span class="sd">         exp_smiles (str): Experimental molecule smiles string</span>
<span class="sd">         ref_id (Optional[str], optional): A name or id for the reference molecule. Defaults to None.</span>
<span class="sd">         exp_id (Optional[str], optional): A name or id for the experimetal molecule. Defaults to None.</span>
<span class="sd">         filename (Optional[str], optional): Filename to save the image to. Defaults to None.</span>
<span class="sd">         weights (Optional[List[float]]): list of atomic contributions to use as weighting. Default to None.</span>
<span class="sd">         normalized (bool): whether to minmax normalize the weights or use the raw values. Defaults to False.</span>
<span class="sd">         radius (int, optional): radius of teh fingerprint if using morgan fingerprint. Defaults to 2.</span>
<span class="sd">         fp (str, optional): The fingerprint to use for a molecule rep. Options are: &#39;morgan&#39;, &#39;atompair&#39;, &#39;torsion&#39; or &#39;custom&#39; (use custom if passing in weights). Defaults to &quot;morgan&quot;.</span>
<span class="sd">         fp_type (str, optional): The type of fingerprint if using morgan. Use &#39;bv&#39; for binary and &#39;count&#39; for the number of occurence. Defaults to &quot;bv&quot;.</span>
<span class="sd">         metric (Callable, optional): Function to calculate similarity between the fingerprints. Defaults to DataStructs.TanimotoSimilarity.</span>

<span class="sd">     Raises:</span>
<span class="sd">         terr: If the wrong type is input for the fingerprint &#39;fp&#39; option</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">ref_smiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ref_mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">ref_smiles</span><span class="p">)</span>

    <span class="n">exp_mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">exp_smiles</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ref_smiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">ent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ref_id</span><span class="p">,</span> <span class="n">exp_id</span><span class="p">]):</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;similarity_map_</span><span class="si">{</span><span class="n">ref_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">exp_id</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;similarity_map_</span><span class="si">{</span><span class="n">CalcMolFormula</span><span class="p">(</span><span class="n">ref_mol</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">CalcMolFormula</span><span class="p">(</span><span class="n">exp_mol</span><span class="p">)</span><span class="si">}</span><span class="s2">.png&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exp_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;similarity_map_</span><span class="si">{</span><span class="n">exp_id</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;similarity_map_</span><span class="si">{</span><span class="n">CalcMolFormula</span><span class="p">(</span><span class="n">exp_mol</span><span class="p">)</span><span class="si">}</span><span class="s2">.png&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">terr</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">terr</span><span class="p">(</span>
            <span class="s2">&quot;fp type should be string one of &#39;morgan&#39;, &#39;atompair&#39;, &#39;torsion&#39; or &#39;custom&#39;&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">fp</span> <span class="o">==</span> <span class="s2">&quot;morgan&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">normalized</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetAtomicWeightsForFingerprint</span><span class="p">(</span>
                <span class="n">ref_mol</span><span class="p">,</span>
                <span class="n">exp_mol</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">inx</span><span class="p">:</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span>
                    <span class="n">m</span><span class="p">,</span> <span class="n">atomId</span><span class="o">=</span><span class="n">inx</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">fpType</span><span class="o">=</span><span class="n">fp_type</span>
                <span class="p">),</span>
                <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapFromWeights</span><span class="p">(</span>
                <span class="n">exp_mol</span><span class="p">,</span>
                <span class="n">weights</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">maxweight</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapForFingerprint</span><span class="p">(</span>
                <span class="n">ref_mol</span><span class="p">,</span>
                <span class="n">exp_mol</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">inx</span><span class="p">:</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span>
                    <span class="n">m</span><span class="p">,</span> <span class="n">atomId</span><span class="o">=</span><span class="n">inx</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">fpType</span><span class="o">=</span><span class="n">fp_type</span>
                <span class="p">),</span>
                <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max weight before normalization is </span><span class="si">{</span><span class="n">maxweight</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">fp</span> <span class="o">==</span> <span class="s2">&quot;atompair&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">normalized</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetAtomicWeightsForFingerprint</span><span class="p">(</span>
                <span class="n">ref_mol</span><span class="p">,</span> <span class="n">exp_mol</span><span class="p">,</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetAPFingerprint</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span>
            <span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapFromWeights</span><span class="p">(</span>
                <span class="n">exp_mol</span><span class="p">,</span>
                <span class="n">weights</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">maxweight</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapForFingerprint</span><span class="p">(</span>
                <span class="n">ref_mol</span><span class="p">,</span> <span class="n">exp_mol</span><span class="p">,</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetAPFingerprint</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max weight before normalization is </span><span class="si">{</span><span class="n">maxweight</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">fp</span> <span class="o">==</span> <span class="s2">&quot;torsion&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">normalized</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetAtomicWeightsForFingerprint</span><span class="p">(</span>
                <span class="n">ref_mol</span><span class="p">,</span> <span class="n">exp_mol</span><span class="p">,</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetTTFingerprint</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span>
            <span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapFromWeights</span><span class="p">(</span>
                <span class="n">exp_mol</span><span class="p">,</span>
                <span class="n">weights</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">maxweight</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapForFingerprint</span><span class="p">(</span>
                <span class="n">ref_mol</span><span class="p">,</span> <span class="n">exp_mol</span><span class="p">,</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetTTFingerprint</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max weight before normalization is </span><span class="si">{</span><span class="n">maxweight</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">normalized</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapFromWeights</span><span class="p">(</span><span class="n">exp_mol</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">weights_normed</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">weights</span>
            <span class="p">]</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapFromWeights</span><span class="p">(</span>
                <span class="n">exp_mol</span><span class="p">,</span> <span class="n">weights_normed</span><span class="p">,</span> <span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Min weight before normalization is </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="si">}</span><span class="s2">. Max weight before normalization is </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown options given fp should be one of &#39;morgan&#39;, &#39;atompair&#39; or &#39;torsion&#39; user has given </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s2"> or weights must not be None user has given </span><span class="si">{</span><span class="n">weights</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.vis.seaborn_correlation_heat_map">
    <p>def <span class="ident">seaborn_correlation_heat_map</span>(</p><p>df: pandas.core.frame.DataFrame, subset_colummns: Optional[List[str]] = None, width: int = 15, filename: str = &#39;heat_map.png&#39;, row_column_scaler: float = 2.0, square: bool = True, vmin: float = -1.0, vmax: float = 1.0, method: Union[str, Callable] = &#39;pearson&#39;, title: Optional[str] = None, xlabel: Optional[str] = None, ylabel: Optional[str] = None, fontsize: int = 20, **kwargs)</p>
    </div>




    <div class="desc"><p>Function to plot a seaborn correlation heat map of a dataframe</p>
<p>Args:
    df (pd.DataFrame): The dataframe to plot
    subset_colummns (Optional[List[str]], optional): The columns to subset the dataframe to. Defaults to None.
    width (int, optional): The width of the column names. Defaults to 15.
    filename (str, optional): Filename to save the plot to. Defaults to "heat_map.png".
    row_column_scaler (float, optional): The scaler to multiply the row and column size by. Defaults to 2.0.
    square (bool, optional): Whether to make the plot square. Defaults to True.
    vmin (float, optional): The minimum value of the colour map. Defaults to -1.0.
    vmax (float, optional): The maximum value of the colour map. Defaults to 1.0.
    method (Union[str, Callable], optional): The method to calculate the correlation. Defaults to "pearson".
    title (Optional[str], optional): The title of the plot. Defaults to None.
    xlabel (Optional[str], optional): The x axis label. Defaults to None.
    ylabel (Optional[str], optional): The y axis label. Defaults to None.
    fontsize (int, optional): The fontsize of the title. Defaults to 20.</p>
<p>Returns:
    Axes: The axis of the plot</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.vis.seaborn_correlation_heat_map', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.vis.seaborn_correlation_heat_map" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">seaborn_correlation_heat_map</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">subset_colummns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;heat_map.png&quot;</span><span class="p">,</span>
    <span class="n">row_column_scaler</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
    <span class="n">square</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">vmin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pearson&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to plot a seaborn correlation heat map of a dataframe</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): The dataframe to plot</span>
<span class="sd">        subset_colummns (Optional[List[str]], optional): The columns to subset the dataframe to. Defaults to None.</span>
<span class="sd">        width (int, optional): The width of the column names. Defaults to 15.</span>
<span class="sd">        filename (str, optional): Filename to save the plot to. Defaults to &quot;heat_map.png&quot;.</span>
<span class="sd">        row_column_scaler (float, optional): The scaler to multiply the row and column size by. Defaults to 2.0.</span>
<span class="sd">        square (bool, optional): Whether to make the plot square. Defaults to True.</span>
<span class="sd">        vmin (float, optional): The minimum value of the colour map. Defaults to -1.0.</span>
<span class="sd">        vmax (float, optional): The maximum value of the colour map. Defaults to 1.0.</span>
<span class="sd">        method (Union[str, Callable], optional): The method to calculate the correlation. Defaults to &quot;pearson&quot;.</span>
<span class="sd">        title (Optional[str], optional): The title of the plot. Defaults to None.</span>
<span class="sd">        xlabel (Optional[str], optional): The x axis label. Defaults to None.</span>
<span class="sd">        ylabel (Optional[str], optional): The y axis label. Defaults to None.</span>
<span class="sd">        fontsize (int, optional): The fontsize of the title. Defaults to 20.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Axes: The axis of the plot</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">subset_colummns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">subset_colummns</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
            <span class="n">row_column_scaler</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
            <span class="n">row_column_scaler</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">),</span>
        <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
        <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">square</span><span class="o">=</span><span class="n">square</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.vis.seaborn_pair_plot">
    <p>def <span class="ident">seaborn_pair_plot</span>(</p><p>df: pandas.core.frame.DataFrame, subset_colummns: Optional[List[str]] = None, width: int = 15, filename: str = &#39;pair_plot.png&#39;, row_column_scaler: float = 2.0, kind: str = &#39;reg&#39;, diag_kind: str = &#39;kde&#39;, title: Optional[str] = None, fontsize: int = 20, **kwargs)</p>
    </div>




    <div class="desc"><p>Function to plot a seaborn pair plot of a dataframe</p>
<p>Args:
    df (pd.DataFrame): The dataframe to plot
    subset_colummns (Optional[List[str]], optional): The columns to subset the dataframe to. Defaults to None.
    width (int, optional): The width of the column names. Defaults to 15.
    filename (str, optional): Filename to save the plot to. Defaults to "pair_plot.png".
    row_column_scaler (float, optional): The scaler to multiply the row and column size by. Defaults to 2.0.
    kind (str, optional): The kind of plot to use. Defaults to "reg".
    diag_kind (str, optional): The kind of plot to use on the diagonal. Defaults to "kde".
    title (Optional[str], optional): The title of the plot. Defaults to None.
    fontsize (int, optional): The fontsize of the title. Defaults to 20.</p>
<p>Returns:
    Axes: The axis of the plot</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.vis.seaborn_pair_plot', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.vis.seaborn_pair_plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">seaborn_pair_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">subset_colummns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pair_plot.png&quot;</span><span class="p">,</span>
    <span class="n">row_column_scaler</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
    <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;reg&quot;</span><span class="p">,</span>
    <span class="n">diag_kind</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;kde&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to plot a seaborn pair plot of a dataframe</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): The dataframe to plot</span>
<span class="sd">        subset_colummns (Optional[List[str]], optional): The columns to subset the dataframe to. Defaults to None.</span>
<span class="sd">        width (int, optional): The width of the column names. Defaults to 15.</span>
<span class="sd">        filename (str, optional): Filename to save the plot to. Defaults to &quot;pair_plot.png&quot;.</span>
<span class="sd">        row_column_scaler (float, optional): The scaler to multiply the row and column size by. Defaults to 2.0.</span>
<span class="sd">        kind (str, optional): The kind of plot to use. Defaults to &quot;reg&quot;.</span>
<span class="sd">        diag_kind (str, optional): The kind of plot to use on the diagonal. Defaults to &quot;kde&quot;.</span>
<span class="sd">        title (Optional[str], optional): The title of the plot. Defaults to None.</span>
<span class="sd">        fontsize (int, optional): The fontsize of the title. Defaults to 20.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Axes: The axis of the plot</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">subset_colummns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">subset_colummns</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
            <span class="n">row_column_scaler</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
            <span class="n">row_column_scaler</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="n">diag_kind</span><span class="o">=</span><span class="n">diag_kind</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.vis.tanimoto_box_plot">
    <p>def <span class="ident">tanimoto_box_plot</span>(</p><p>df1: pandas.core.frame.DataFrame, df2: pandas.core.frame.DataFrame, labels_column_1: str, smiles_column_1: str, smiles_column_2: str, filename: str = &#39;tanimoto_box_plot.png&#39;, fps1: Optional[list] = None, fps2: Optional[list] = None, dist: bool = False)</p>
    </div>




    <div class="desc"><p>Function to calculate the symmetric Tanimoto similarity matrix</p>
<p>Args:
    df1 (pd.DataFrame): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.
    df2 (pd.DataFrame): Dataframe of the first set of smiles to compare to. These for the test cases to make the distrbution i.e. how similar is each molecule in this set to each one at a time from df1. Defaults to None.
    labels_column_1 (str): The column containing labels from data set 1. Defaults to None.
    smiles_column_1 (str): The column containing smiles for the molecules. Defaults to None.
    smiles_column_2 (str): The column containing smiles for the molecules. Defaults to None.
    filename (str): the file to save the plot to
    fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.
    fps2 (Optional[list], optional): Precomputed fingerprints for df2. Defaults to None.
    dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.vis.tanimoto_box_plot', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.vis.tanimoto_box_plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">tanimoto_box_plot</span><span class="p">(</span>
    <span class="n">df1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">df2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">labels_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">smiles_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">smiles_column_2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tanimoto_box_plot.png&quot;</span><span class="p">,</span>
    <span class="n">fps1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fps2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the symmetric Tanimoto similarity matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        df1 (pd.DataFrame): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.</span>
<span class="sd">        df2 (pd.DataFrame): Dataframe of the first set of smiles to compare to. These for the test cases to make the distrbution i.e. how similar is each molecule in this set to each one at a time from df1. Defaults to None.</span>
<span class="sd">        labels_column_1 (str): The column containing labels from data set 1. Defaults to None.</span>
<span class="sd">        smiles_column_1 (str): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        smiles_column_2 (str): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        filename (str): the file to save the plot to</span>
<span class="sd">        fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.</span>
<span class="sd">        fps2 (Optional[list], optional): Precomputed fingerprints for df2. Defaults to None.</span>
<span class="sd">        dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">get_tanimoto_matrix</span><span class="p">(</span>
        <span class="n">df1</span><span class="p">,</span>
        <span class="n">df2</span><span class="p">,</span>
        <span class="n">labels_column_1</span><span class="p">,</span>
        <span class="n">smiles_column_1</span><span class="p">,</span>
        <span class="n">smiles_column_2</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span>
        <span class="n">fps1</span><span class="o">=</span><span class="n">fps1</span><span class="p">,</span>
        <span class="n">fps2</span><span class="o">=</span><span class="n">fps2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># plot box plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tanimoto_measures</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">tanimoto_measures</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">rot</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Molecule Labels&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Tanimoto Smiliarlity&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Tanimoto Distance&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.vis.tanimoto_distrbution_plots">
    <p>def <span class="ident">tanimoto_distrbution_plots</span>(</p><p>df1: pandas.core.frame.DataFrame, df2: pandas.core.frame.DataFrame, labels_column_1: str, smiles_column_1: str, smiles_column_2: str, filename: str = &#39;tanimoto_distrbution_plot.png&#39;, fps1=None, fps2=None, dist=False)</p>
    </div>




    <div class="desc"><p>Function to calculate the symmetric Tanimoto similarity matrix</p>
<p>Args:
    df1 (pd.DataFrame): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.
    df2 (pd.DataFrame): Dataframe of the first set of smiles to compare to. These for the test cases to make the distrbution i.e. how similar is each molecule in this set to each one at a time from df1. Defaults to None.
    labels_column_1 (str): The column containing labels from data set 1. Defaults to None.
    smiles_column_1 (str): The column containing smiles for the molecules. Defaults to None.
    smiles_column_2 (str): The column containing smiles for the molecules. Defaults to None.
    filename (str): the file to save the plot to
    fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.
    fps2 (Optional[list], optional): Precomputed fingerprints for df2. Defaults to None.
    dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.vis.tanimoto_distrbution_plots', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.vis.tanimoto_distrbution_plots" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">tanimoto_distrbution_plots</span><span class="p">(</span>
    <span class="n">df1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">df2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">labels_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">smiles_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">smiles_column_2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tanimoto_distrbution_plot.png&quot;</span><span class="p">,</span>
    <span class="n">fps1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fps2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the symmetric Tanimoto similarity matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        df1 (pd.DataFrame): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.</span>
<span class="sd">        df2 (pd.DataFrame): Dataframe of the first set of smiles to compare to. These for the test cases to make the distrbution i.e. how similar is each molecule in this set to each one at a time from df1. Defaults to None.</span>
<span class="sd">        labels_column_1 (str): The column containing labels from data set 1. Defaults to None.</span>
<span class="sd">        smiles_column_1 (str): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        smiles_column_2 (str): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        filename (str): the file to save the plot to</span>
<span class="sd">        fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.</span>
<span class="sd">        fps2 (Optional[list], optional): Precomputed fingerprints for df2. Defaults to None.</span>
<span class="sd">        dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tm_mat</span> <span class="o">=</span> <span class="n">get_tanimoto_matrix</span><span class="p">(</span>
        <span class="n">df1</span><span class="p">,</span>
        <span class="n">df2</span><span class="p">,</span>
        <span class="n">labels_column_1</span><span class="o">=</span><span class="n">labels_column_1</span><span class="p">,</span>
        <span class="n">smiles_column_1</span><span class="o">=</span><span class="n">smiles_column_1</span><span class="p">,</span>
        <span class="n">smiles_column_2</span><span class="o">=</span><span class="n">smiles_column_2</span><span class="p">,</span>
        <span class="n">fps1</span><span class="o">=</span><span class="n">fps1</span><span class="p">,</span>
        <span class="n">fps2</span><span class="o">=</span><span class="n">fps2</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">medians</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tm_mat</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">])</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tm_mat</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">indx_med</span><span class="p">,</span> <span class="n">indx_mean</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">medians</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">means</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">indx_med</span> <span class="o">!=</span> <span class="n">indx_mean</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Indexes are different between the mean and median series!&quot;</span>
            <span class="p">)</span>

    <span class="n">averages</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">medians</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">averages</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">kde</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">colormap</span><span class="o">=</span><span class="s2">&quot;bwr&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Average Tanimoto Similarity Distrbution&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Average Tanimoto Distance Distrbution&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.vis.tanimoto_distrbution_plots_intra_dataset">
    <p>def <span class="ident">tanimoto_distrbution_plots_intra_dataset</span>(</p><p>df1: pandas.core.frame.DataFrame, labels_column_1: str, smiles_column_1: str, filename: str = &#39;tanimoto_distrbution_plot.png&#39;, fps1=None, dist=False)</p>
    </div>




    <div class="desc"><p>Function to calculate the symmetric Tanimoto similarity matrix</p>
<p>Args:
    df1 (pd.DataFrame): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.
    labels_column_1 (str): The column containing labels from data set 1. Defaults to None.
    smiles_column_1 (str): The column containing smiles for the molecules. Defaults to None.
    filename (str): the file to save the plot to
    fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.
    dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.vis.tanimoto_distrbution_plots_intra_dataset', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.vis.tanimoto_distrbution_plots_intra_dataset" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">tanimoto_distrbution_plots_intra_dataset</span><span class="p">(</span>
    <span class="n">df1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">labels_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">smiles_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tanimoto_distrbution_plot.png&quot;</span><span class="p">,</span>
    <span class="n">fps1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the symmetric Tanimoto similarity matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        df1 (pd.DataFrame): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.</span>
<span class="sd">        labels_column_1 (str): The column containing labels from data set 1. Defaults to None.</span>
<span class="sd">        smiles_column_1 (str): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        filename (str): the file to save the plot to</span>
<span class="sd">        fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.</span>
<span class="sd">        dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tm_mat</span> <span class="o">=</span> <span class="n">get_tanimoto_intra_dataset_matrix</span><span class="p">(</span>
        <span class="n">df1</span><span class="p">,</span>
        <span class="n">labels_column_1</span><span class="o">=</span><span class="n">labels_column_1</span><span class="p">,</span>
        <span class="n">smiles_column_1</span><span class="o">=</span><span class="n">smiles_column_1</span><span class="p">,</span>
        <span class="n">fps1</span><span class="o">=</span><span class="n">fps1</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">medians</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tm_mat</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">])</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tm_mat</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">indx_med</span><span class="p">,</span> <span class="n">indx_mean</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">medians</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">means</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">indx_med</span> <span class="o">!=</span> <span class="n">indx_mean</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Indexes are different between the mean and median series!&quot;</span>
            <span class="p">)</span>

    <span class="n">averages</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">medians</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">averages</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">kde</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">colormap</span><span class="o">=</span><span class="s2">&quot;bwr&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Average Tanimoto Similarity Distrbution&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Average Tanimoto Distance Distrbution&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="chemutil.vis.tanimoto_intra_dataset_box_plot">
    <p>def <span class="ident">tanimoto_intra_dataset_box_plot</span>(</p><p>df1: pandas.core.frame.DataFrame, labels_column_1: str, smiles_column_1: str, filename: str = &#39;tanimoto_box_plot.png&#39;, fps1: Optional[list] = None, dist: bool = False)</p>
    </div>




    <div class="desc"><p>Function to calculate the symmetric Tanimoto similarity matrix</p>
<p>Args:
    df1 (pd.DataFrame): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.
    labels_column_1 (str): The column containing labels from data set 1. Defaults to None.
    smiles_column_1 (str): The column containing smiles for the molecules. Defaults to None.
    filename (str): the file to save the plot to
    fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.
    dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-chemutil.vis.tanimoto_intra_dataset_box_plot', this);">Show source &equiv;</a></p>
  <div id="source-chemutil.vis.tanimoto_intra_dataset_box_plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">tanimoto_intra_dataset_box_plot</span><span class="p">(</span>
    <span class="n">df1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">labels_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">smiles_column_1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tanimoto_box_plot.png&quot;</span><span class="p">,</span>
    <span class="n">fps1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the symmetric Tanimoto similarity matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        df1 (pd.DataFrame): Dataframe of the first set of smiles to compare against. These are used as the reference set and will provide labels to the columns if the label column is defined. Defaults to None.</span>
<span class="sd">        labels_column_1 (str): The column containing labels from data set 1. Defaults to None.</span>
<span class="sd">        smiles_column_1 (str): The column containing smiles for the molecules. Defaults to None.</span>
<span class="sd">        filename (str): the file to save the plot to</span>
<span class="sd">        fps1 (Optional[list], optional): Precomputed fingerprints for df1. Defaults to None.</span>
<span class="sd">        dist (bool, optional): Calculate simialrity if this False (default) or distance is this is True. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tanimoto_measures</span> <span class="o">=</span> <span class="n">get_tanimoto_intra_dataset_matrix</span><span class="p">(</span>
        <span class="n">df1</span><span class="p">,</span>
        <span class="n">labels_column_1</span><span class="p">,</span>
        <span class="n">smiles_column_1</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span>
        <span class="n">fps1</span><span class="o">=</span><span class="n">fps1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">tanimoto_measures</span><span class="p">)</span>

    <span class="c1"># plot box plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tanimoto_measures</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">tanimoto_measures</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">rot</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Molecule Labels&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Tanimoto Smiliarlity&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Tanimoto Distance&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>



  </section>
</article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Generated by <a href="https://github.com/timothycrosley/pdocs">pdocs 1.2.0</a>
    </p>
  </footer>
</div>
</body>
</html>
